<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Linux Device Drivers" /><meta property="og:locale" content="en" /><meta name="description" content="This is a practical study I made using some videos and written resources to understand device drivers to some extent." /><meta property="og:description" content="This is a practical study I made using some videos and written resources to understand device drivers to some extent." /><link rel="canonical" href="https://tanishq.page/blog/posts/linux-device-drivers/" /><meta property="og:url" content="https://tanishq.page/blog/posts/linux-device-drivers/" /><meta property="og:site_name" content="Tanishq Rupaal" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-09-12T03:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Linux Device Drivers" /><meta name="twitter:site" content="@etheriosking" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-09-12T03:00:00-04:00","datePublished":"2019-09-12T03:00:00-04:00","description":"This is a practical study I made using some videos and written resources to understand device drivers to some extent.","headline":"Linux Device Drivers","mainEntityOfPage":{"@type":"WebPage","@id":"https://tanishq.page/blog/posts/linux-device-drivers/"},"url":"https://tanishq.page/blog/posts/linux-device-drivers/"}</script><title>Linux Device Drivers | Tanishq Rupaal</title><link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/blog/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tanishq Rupaal"><meta name="application-name" content="Tanishq Rupaal"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/blog/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/blog/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.27.20/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { let self = this;this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { self.clearMode(); } self.notify(); }); if (!this.hasMode) { return; } if (this.isDarkMode) { this.setDark(); } else { this.setLight(); } } get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isPreferDark() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }get modeStatus() { if (this.hasMode) { return this.mode; } else { return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); }notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { this.clearMode(); } else { if (this.isPreferDark) { this.setLight(); } else { this.setDark(); } } this.notify(); } } const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/blog/" id="avatar" class="rounded-circle"><img src="/blog/assets/Abstract.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/blog/">Tanishq Rupaal</a></h1><p class="site-subtitle fst-italic mb-0">Cybersecurity Professional</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blog/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/blog/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/blog/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/blog/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tanq16" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/etheriosking" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['dragonking47','proton.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://linkedin.com/in/tanishqrupaal" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/blog/">Home</a> </span> <span>Linux Device Drivers</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Linux Device Drivers</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1568271600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 12, 2019 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2712 words" > <em>15 min</em> read</span></div></div></div></header><div class="content"><p>This is a practical study I made using some videos and written resources to understand device drivers to some extent.</p><h2 id="building-a-module"><span class="me-2">Building a module</span><a href="#building-a-module" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Device drivers hide the details of how the device works. User activities are performed by standardized calls that are independent of the specific driver. Device drivers map these calls to device-specific operations that act in real hardware. Drivers can be integrated into the kernel as well as built separately and dynamically loaded at runtime when needed. These are called loadable modules. Linux looks at device drivers in three different fundamental types -</p><ol><li><code class="language-plaintext highlighter-rouge">Character devices</code><li><code class="language-plaintext highlighter-rouge">Block devices</code><li><code class="language-plaintext highlighter-rouge">Network devices</code></ol><p>Character device is one that can be accessed as a stream for bytes. Uses a char driver. Eg Keyboard, mouse, camera, etc. Most char devices are just data channels which can be accessed sequentially. Block devices are those which has a file system on it i.e., we can create files and directories and there is an option of moving back and forth. Reads from block devices are in chunks or blocks of data. Eg. pen drive, disks, etc.</p><p>Making of a simple dynamically loadable program driver which can be added and removed. <code class="language-plaintext highlighter-rouge">example.c</code> -</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="cp">#include</span><span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">simplemod_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">simplemod_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">simplemod_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">simplemod_exit</span><span class="p">);</span>
</pre></table></code></div></div><p>The init function gets called when the module is inserted/loaded in the kernel space. Module can be initialized here. The exit function is called when the module is removed/unloaded. Cleanups can be performed here. Last two lines are helper modules to identify the functions.</p><p>For a simple module to be compiled om a linux system, we need to have a build directory on which we will execute the module. Requirement is the kernel build directory for the version of the kernel running on the machine. To do that type on terminal -</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">uname</span> <span class="nt">-r</span>
</pre></table></code></div></div><p>We need the directory which contains the binary for the returned version of linux. Therefore, to compile the module we make a makefile. <code class="language-plaintext highlighter-rouge">Makefile</code> -</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>obj-m:<span class="o">=</span>example.o
</pre></table></code></div></div><p>This states a need to build a module (m for module). It then generates the specified <code class="language-plaintext highlighter-rouge">.o</code> file from the corresponding <code class="language-plaintext highlighter-rouge">.c</code> file and then generates the <code class="language-plaintext highlighter-rouge">.ko</code> file from the <code class="language-plaintext highlighter-rouge">.o</code> file. <code class="language-plaintext highlighter-rouge">:=</code> is used to initialize the obj-m list of files to be compiled to a string on the right hand side. <code class="language-plaintext highlighter-rouge">+=</code> is used to add to the obj-m list of files to be compiled. To build the module, type on terminal -</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>make <span class="nt">-C</span> /lib/modules/<span class="si">$(</span><span class="nb">uname</span> <span class="nt">-r</span><span class="si">)</span>/build <span class="nv">M</span><span class="o">=</span><span class="nv">$PWD</span> modules
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">-C</code> is to change the directory to the <code class="language-plaintext highlighter-rouge">/lib/module/&lt;running kernel&gt;/build</code> directory. The make utility goes to the specified directory and pickup the makefile from there which would contain all info about processor, compilers to be used, optimization done to the kernel, etc.<li>But we need to build the own module, not the kernel. So we specify <code class="language-plaintext highlighter-rouge">M=$PWD</code> which specifies to pickup the makefile from the present working directory. The <code class="language-plaintext highlighter-rouge">modules</code> in the end specifies what to do (build a module). We see the result as -</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>make: Entering directory '/usr/src/linux-headers-4.13.0-26-generic'
  CC [M]  /home/asus/TANISHQ/example.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /home/asus/TANISHQ/example.mod.o
  LD [M]  /home/asus/TANISHQ/example.ko
make: Leaving directory '/usr/src/linux-headers-4.13.0-26-generic'
</pre></table></code></div></div><p>We would now have a file by the name <code class="language-plaintext highlighter-rouge">example.ko</code> which is a kernel object. This is the driver that will be inserted into kernel space. To insert this module we use a utility called <code class="language-plaintext highlighter-rouge">insmod</code>. It places the module from storage into the kernel space.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>insmod ./example.ko
</pre></table></code></div></div><p>sudo is used as we are changing something in the kernel space. The command will simply return. To check if the module is loaded, type command -</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>lsmod | <span class="nb">grep </span>example
</pre></table></code></div></div><p>This returns something like -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>example             16384   0
</pre></table></code></div></div><p>To remove the module, we use <code class="language-plaintext highlighter-rouge">rmmod</code> as -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo rmmod example
</pre></table></code></div></div><p>The final prints will appear on log files.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo cat /var/log/syslog | grep inside
</pre></table></code></div></div><p>This gives result <code class="language-plaintext highlighter-rouge">Jan 24 19:59:57 asus kernel: [ 7803.715538] inside simple_module_init function Jan 24 20:00:13 asus kernel: [ 7819.304305] inside simple_module_exit function</code></p><p>To see the effects of init and exit functions, create two files <code class="language-plaintext highlighter-rouge">exmod_init.c</code> and <code class="language-plaintext highlighter-rouge">exmod_exit.c</code>, each having only the init and the exit functions respectively.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="cp">#include</span><span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">simple_module_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"Inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="n">__FUNCTION__</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">simple_module_init</span><span class="p">);</span>
<span class="cp">#include</span><span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
</span>
<span class="kt">void</span> <span class="nf">simple_module_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"Inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="n">__FUNCTION__</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_exit</span><span class="p">(</span><span class="n">simple_module_exit</span><span class="p">);</span>
</pre></table></code></div></div><p>Edit the Makefile to -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>obj-m:=example.o
obj-m += exmod_init.o
obj-m += exmod_exit.o
</pre></table></code></div></div><p>Now after running the same make command, the result is -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>make -C /lib/modules/$(uname -r)/build M=$PWD modules

make: Entering directory '/usr/src/linux-headers-4.13.0-26-generic'
  CC [M]  /home/asus/Tanishq/devdr2/example.o
  CC [M]  /home/asus/Tanishq/devdr2/exmod_init.o
  CC [M]  /home/asus/Tanishq/devdr2/exmod_exit.o
  Building modules, stage 2.
  MODPOST 3 modules
  CC      /home/asus/Tanishq/devdr2/example.mod.o
  LD [M]  /home/asus/Tanishq/devdr2/example.ko
  CC      /home/asus/Tanishq/devdr2/exmod_exit.mod.o
  LD [M]  /home/asus/Tanishq/devdr2/exmod_exit.ko
  CC      /home/asus/Tanishq/devdr2/exmod_init.mod.o
  LD [M]  /home/asus/Tanishq/devdr2/exmod_init.ko
make: Leaving directory '/usr/src/linux-headers-4.13.0-26-generic'
</pre></table></code></div></div><p>Now there are kernel modules for the two new files as well. On loading the <code class="language-plaintext highlighter-rouge">exmod_exit.ko</code> module, we do not get an alert after loading as there is no init function. On removing it, we get the required alert as there is an exit function.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Jan 25 01:24:16 asus kernel: [ 4316.859080] Inside simple_module_exit function
</pre></table></code></div></div><p>On loading the <code class="language-plaintext highlighter-rouge">exmod_init.ko</code> module, we get the desired alert as there is an init function.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Jan 25 01:25:21 asus kernel: [ 4381.815867] Inside simple_module_init function
</pre></table></code></div></div><p>But on using rmmod on the module we get an error as there is no exit function.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>rmmod: ERROR: ../libkmod/libkmod-module.c:793 kmod_module_remove_module() could not remove 'exmod_init': Device or resource busy
rmmod: ERROR: could not remove module exmod_init: Device or resource busy
</pre></table></code></div></div><p>This module then continues to exist in the running modules list which can be checked using the <code class="language-plaintext highlighter-rouge">lsmod</code> command.</p><p>(This module is automatically unloaded after a reboot.)</p><hr /><h2 id="building-module-using-multiple-files-and-module-license-and-__init"><span class="me-2">Building module using multiple files and module license and __init</span><a href="#building-module-using-multiple-files-and-module-license-and-__init" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>For using multiple c files, edit the makefile to add a rule</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>obj-m := multimodule.o
multimodule.obj$ := exmod_init.o exmod_exit.o
</pre></table></code></div></div><p>The last line tells what files to use to build the <code class="language-plaintext highlighter-rouge">multifile</code> module. Also using <code class="language-plaintext highlighter-rouge">:=</code> again has reset the name from example.o to <code class="language-plaintext highlighter-rouge">multimodule.o</code>. Now to make the module, run -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>!make
</pre></table></code></div></div><p>to run the previous run command for make. Now using <code class="language-plaintext highlighter-rouge">insmod</code> and <code class="language-plaintext highlighter-rouge">rmmod</code> gives the desired results.</p><p>Add a line to <code class="language-plaintext highlighter-rouge">example.c</code> -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>MODULE_LICENSE("GPL");
</pre></table></code></div></div><p>after the header file inclusion lines. Without this line, the kernel assumes that we have a proprietary or private license for which we are not willing to share the source code. On running without this line the log consists of a line</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>Jan 29 01:48:05 asus-p8z77v kernel: [   95.022260] example: loading out-of-tree module taints kernel.
Jan 29 01:48:05 asus-p8z77v kernel: [   95.022263] example: module license 'unspecified' taints kernel.
Jan 29 01:48:05 asus-p8z77v kernel: [   95.022264] Disabling lock debugging due to kernel taint
Jan 29 01:48:05 asus-p8z77v kernel: [   95.022312] example: module verification failed: signature and/or required key missing - tainting kernel
</pre></table></code></div></div><p>The kernel thinks that the code is something that can potentially damage the kernel. Also some functionalities of the kernel will not be available without specifying the license (like lock debugging see above and USB support, etc.). Add <code class="language-plaintext highlighter-rouge">__init</code> before declaring the init function -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>__init int simplemod_init(void)
</pre></table></code></div></div><p>The init function is only required to be called when the <code class="language-plaintext highlighter-rouge">insmod</code> function is called. After the <code class="language-plaintext highlighter-rouge">insmod</code> returns the init function is never going to be called again in the duration of the module. By specifying <code class="language-plaintext highlighter-rouge">__init</code>, we indicate that the function is only required when initialization is done. After that the module is not required to be present in the kernel space to save more space in RAM. So this releases some memory of the kernel RAM which can be used for some other purpose. So copy this to another file called <code class="language-plaintext highlighter-rouge">example2.c</code>. Add a loop to the <code class="language-plaintext highlighter-rouge">example.c</code> file -</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">#include</span><span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
</span>
<span class="n">__initdata</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="n">__init</span> <span class="kt">int</span> <span class="nf">simplemod_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"Index = %d</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">simplemod_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">simplemod_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">simplemod_exit</span><span class="p">);</span>
</pre></table></code></div></div><p>In the above code snippet, the value of the global variable count is used only by the init function, so to free up that space used by it after the execution of the <code class="language-plaintext highlighter-rouge">insmod</code> command, we use <code class="language-plaintext highlighter-rouge">__initdata</code> prefix.</p><h3 id="kernel-difference-min-size-etc"><span class="me-2">kernel difference (min size etc.)</span><a href="#kernel-difference-min-size-etc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The <code class="language-plaintext highlighter-rouge">__init</code> can be prefixed on some user defined functions as well but we need to make sure that the function is only invoked by the init function. If a function is declared <code class="language-plaintext highlighter-rouge">__init</code> and is also being called by the exit function, then on exiting when the call is made to the function which is not actually present in the RAM, the kernel experiences a page fault and therefore crashes. The output regarding size difference between modules written by same code except for the <code class="language-plaintext highlighter-rouge">__init</code> declared function.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>example2                        12390   0
example                         12442   0
</pre></table></code></div></div><hr /><h2 id="exporting-symbols"><span class="me-2">Exporting symbols</span><a href="#exporting-symbols" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Add a function called <code class="language-plaintext highlighter-rouge">mod_symbolex</code> to the example code.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="cp">#include</span><span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">mod_symbolex</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">mod_symbolex</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">simplemod_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">simplemod_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">simplemod_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">simplemod_exit</span><span class="p">);</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">EXPORT_SYMBOL</code> macro takes a name which can be a variable or a function which can be exported from this module to any other module in the kernel space. On a new <code class="language-plaintext highlighter-rouge">module.c</code> file, call the function and also declare a prototype.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="cp">#include</span><span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">mod_symbolex</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">simplemod_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="n">mod_symbolex</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">simplemod_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">simplemod_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">simplemod_exit</span><span class="p">);</span>
</pre></table></code></div></div><p>On loading the module <code class="language-plaintext highlighter-rouge">use.ko</code> then <code class="language-plaintext highlighter-rouge">export.ko</code>, we get the error</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>insmod: ERROR: could not insert module ./use.ko: Unknown symbol in module
</pre></table></code></div></div><p>because the function used in that module isn’t present in the kernel space. Therefore, we need to load the module <code class="language-plaintext highlighter-rouge">export.ko</code> first.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>use                    16384  0
export                 16384  1 use
</pre></table></code></div></div><p>The log file also contains the respective function names.</p><hr /><h2 id="module-parameters"><span class="me-2">Module parameters</span><a href="#module-parameters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Module parameters are the arguments given to a module. To use this functionality we need to add a header file <code class="language-plaintext highlighter-rouge">linux/moduleparam.h</code>. Make a C source file -</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">#include</span><span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/moduleparam.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">simplemod_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">count</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"hi %d</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">simplemod_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">simplemod_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">simplemod_exit</span><span class="p">);</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">module_param</code> is a macro which takes three arguments - variable name, size and permission. If we load the module now, hi will be printed once. We can give the variable count as an argument in the following manner -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo insmod module.ko count=5
</pre></table></code></div></div><p>The name of the variable given as a argument should match the name specified in the module_param function. It is optional to pass a module parameter and so should have a default value. The permission’s use can be demonstrated using code -</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="cp">#include</span><span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/moduleparam.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">simplemod_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">count</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"hi %d</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">simplemod_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">count</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"bye %d</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">simplemod_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">simplemod_exit</span><span class="p">);</span>
</pre></table></code></div></div><p>The permission format is the same as the unix permission format. The advantage is that now a variable store file is created in the location <code class="language-plaintext highlighter-rouge">/sys/module/&lt;modulename&gt;/parameters/count</code>. Since it has the permissions 644, we can edit it while the module is loaded. So if we edit this to 5, and then remove the module, then the message bye will be printed 5 times.</p><hr /><h2 id="simple-character-driver-module"><span class="me-2">Simple character driver module</span><a href="#simple-character-driver-module" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">/dev</code> is an in-RAM file system that gets destroyed on reboot. The symbolic links to all devices on the system reside here. On listing the directory we get first character as c for character devices. The two numbers separated by a <code class="language-plaintext highlighter-rouge">,</code> are the major number and minor number. Major number is a way of identifying a driver which can be associated with a device. The minor number corresponds to instances of that device. Make a file <code class="language-plaintext highlighter-rouge">example.c</code> -</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="cp">#include</span><span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;linux/fs.h&gt;</span><span class="cp">
</span>
<span class="kt">ssize_t</span> <span class="nf">example_read</span><span class="p">(</span><span class="k">struct</span> <span class="nc">file</span> <span class="o">*</span><span class="n">pfile</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">ssize_t</span> <span class="nf">example_write</span><span class="p">(</span><span class="k">struct</span> <span class="nc">file</span> <span class="o">*</span><span class="n">pfile</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">length</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">example_open</span><span class="p">(</span><span class="k">struct</span> <span class="nc">inode</span> <span class="o">*</span><span class="n">pinode</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">file</span> <span class="o">*</span><span class="n">pfile</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">example_close</span><span class="p">(</span><span class="k">struct</span> <span class="nc">inode</span> <span class="o">*</span><span class="n">pinode</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">file</span> <span class="o">*</span><span class="n">pfile</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">file_operations</span> <span class="n">example_file_operations</span><span class="o">=</span><span class="p">{</span>
    <span class="p">.</span><span class="n">owner</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">,</span>
    <span class="p">.</span><span class="n">open</span><span class="o">=</span><span class="n">example_open</span><span class="p">,</span>
    <span class="p">.</span><span class="n">read</span><span class="o">=</span><span class="n">example_read</span><span class="p">,</span>
    <span class="p">.</span><span class="n">write</span><span class="o">=</span><span class="n">example_write</span><span class="p">,</span>
    <span class="p">.</span><span class="n">release</span><span class="o">=</span><span class="n">example_close</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">simplemod_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="n">register_chrdev</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="s">"simplechrdev"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">example_file_operations</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">simplemod_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">"inside %s function</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
    <span class="n">unregister_chrdev</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="s">"simplechrdev"</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">simplemod_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">simplemod_exit</span><span class="p">);</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">fs.h</code> header file is used for support of character driver support. <code class="language-plaintext highlighter-rouge">register_chrdev()</code> is a function used to indicate to the kernel that this is a character device driver. It takes in arguments major number, name of the driver and the file operations. In the exit function we also need to deregister the driver. The struct is specified in the <code class="language-plaintext highlighter-rouge">fs.h</code> library. <code class="language-plaintext highlighter-rouge">example_operation</code> is the name given to the operation in that structure. The operations function prototypes are taken from the <code class="language-plaintext highlighter-rouge">/lib/modules/$(uname -r)/build/include/linux/fs.h</code> file. On the newer kernel the same file can be found in <code class="language-plaintext highlighter-rouge">/usr/src/linux-headers-4.13.0-32/include/linux/fs.h</code>. From these prototypes name the functions accordingly and specify names for the parameters. The open and close functions return 0 to indicate successful opening and closing of the files. The read returns 0 to indicate there is no data to return and read was successful. The write returns length to specify the length of data that has been written. There is also a command - <code class="language-plaintext highlighter-rouge">make -C /lib/modules/$(uname -r)/build M=$PWD clean</code> to remove all the clutter generated while building the module. Build the character driver module and insert. The device drivers loaded on a system are given in <code class="language-plaintext highlighter-rouge">/proc/devices</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cat /proc/devices
</pre></table></code></div></div><p>This shows character device drivers first followed by the block device drivers. The first column is the major number and the second is the name for the driver. Output -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>116 alsa
128 ptm
136 pts
180 usb
189 usb_device
204 ttyMAX
216 rfcomm
226 drm
240 simplechrdev
243 media
244 mei
245 kfd
</pre></table></code></div></div><p>Now we need to define a new device in <code class="language-plaintext highlighter-rouge">/dev</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo mknod</span> <span class="nt">-m</span> 666 /dev/mychar_device c 240 0
</pre></table></code></div></div><p>The last <code class="language-plaintext highlighter-rouge">0</code> is the minor number. The command <code class="language-plaintext highlighter-rouge">cat</code> basically opens a file and then reads the contents to display on STDOUT and then closes it. Since, linux does not differentiate between files and character devices, we can run cat command on the device and expect it to open the device, read it then close it. The output in <code class="language-plaintext highlighter-rouge">/var/log/syslog</code> shows this behavior. All the expected functions are called. The same can be done using echo command to write to the device (file, as linux treats it).</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo </span>hello <span class="o">&gt;</span> /dev/mychar_device
</pre></table></code></div></div><p>Output -</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>Feb  2 22:08:43 Kubuntu-TR kernel: [42655.790679] inside simplemod_init function
Feb  2 22:10:39 Kubuntu-TR kernel: [42771.911791] inside example_open function
Feb  2 22:10:39 Kubuntu-TR kernel: [42771.911821] inside example_read function
Feb  2 22:10:39 Kubuntu-TR kernel: [42771.911842] inside example_close function
Feb  2 22:10:53 Kubuntu-TR kernel: [42785.883620] inside example_open function
Feb  2 22:10:53 Kubuntu-TR kernel: [42785.883651] inside example_write function
Feb  2 22:10:53 Kubuntu-TR kernel: [42785.883660] inside example_close function
Feb  2 22:11:10 Kubuntu-TR kernel: [42802.109737] inside simplemod_exit function
</pre></table></code></div></div><hr /></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/categories/computers-and-fun/">Computers and Fun</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/blog/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/blog/tags/drivers/" class="post-tag no-text-decoration" >drivers</a> <a href="/blog/tags/kernel/" class="post-tag no-text-decoration" >kernel</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Linux%20Device%20Drivers%20-%20Tanishq%20Rupaal&url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Flinux-device-drivers%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Linux%20Device%20Drivers%20-%20Tanishq%20Rupaal&u=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Flinux-device-drivers%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Flinux-device-drivers%2F&text=Linux%20Device%20Drivers%20-%20Tanishq%20Rupaal" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Flinux-device-drivers%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/posts/gha-docker-arch/">GitHub Actions & ARM Architecture</a><li class="text-truncate lh-lg"> <a href="/blog/posts/dbs-zamasu-timeline/">Dragon Ball Super - Zamasu Timeline 101</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-wallabag/">Wallabag in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-linkwarden/">Bookmark Manager in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-budgeting/">Personal Finance Budgeting in Home Lab</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/linux/">linux</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/posts/setuid-attack-lab/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1590994800" data-df="ll" > Jun 1, 2020 </time><h4 class="pt-0 my-2">SetUID Attack Lab - SeedLabs</h4><div class="text-muted"><p>Set-UID is an important security mechanism in unix systems. When a Set-UID program is run, the executing program assumes the owner’s privileges irrespective of the user running the program. The tas...</p></div></div></a></article><article class="col"> <a href="/blog/posts/linux-cli-netcat/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1590840000" data-df="ll" > May 30, 2020 </time><h4 class="pt-0 my-2">Basics of Linux Commands and NetCat</h4><div class="text-muted"><p>A shell is an interface to the operating system’s services. All process are created by fork() and given a new direction by the exec() process. The trace of forks and calls can be seen from the stra...</p></div></div></a></article><article class="col"> <a href="/blog/posts/gha-docker-arch/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1717714320" data-df="ll" > Jun 6, 2024 </time><h4 class="pt-0 my-2">GitHub Actions & ARM Architecture</h4><div class="text-muted"><p>This blog post covers my troubleshooting efforts and research on how we can use GitHub workflows for various architectures. It focuses more on how to build container images for ARM in the absence o...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/posts/exploit-exercises-protostar/" class="btn btn-outline-primary" aria-label="Older" ><p>Exploit Exercises Protostar Lab Write-Up</p></a> <a href="/blog/posts/java-socket-programming/" class="btn btn-outline-primary" aria-label="Newer" ><p>Basics of Socket Programming in Java</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.0.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/linux/">linux</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.11/dayjs.min.js,npm/dayjs@1.11.11/locale/en.min.js,npm/dayjs@1.11.11/plugin/relativeTime.min.js,npm/dayjs@1.11.11/plugin/localizedFormat.min.js,npm/tocbot@4.27.20/dist/tocbot.min.js"></script> <script src="/blog/assets/js/dist/post.min.js"></script> <script defer src="/blog/assets/js/dist/app.min.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B88HEPZBVJ"></script> <script> document.addEventListener('DOMContentLoaded', function (event) { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-B88HEPZBVJ'); }); </script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
