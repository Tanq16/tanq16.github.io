<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Containerized Security Toolkit - A Guide" /><meta property="og:locale" content="en" /><meta name="description" content="Since writing this blog, I’ve updated the project significantly with multiple image options. The bulk of the usage below remains relevant, but the images are now named cst-&lt;variant&gt;:arm (or amd for x86_64). Refer to the newer and much more detailed documentation for full details." /><meta property="og:description" content="Since writing this blog, I’ve updated the project significantly with multiple image options. The bulk of the usage below remains relevant, but the images are now named cst-&lt;variant&gt;:arm (or amd for x86_64). Refer to the newer and much more detailed documentation for full details." /><link rel="canonical" href="https://tanishq.page/blog/posts/cst-guide/" /><meta property="og:url" content="https://tanishq.page/blog/posts/cst-guide/" /><meta property="og:site_name" content="Tanishq Rupaal" /><meta property="og:image" content="https://tanishq.page/blog/assets/img/covers/cst-cover.jpg" /><meta property="og:image:alt" content="CST Artwork" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-10-26T13:52:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tanishq.page/blog/assets/img/covers/cst-cover.jpg" /><meta name="twitter:image:alt" content="CST Artwork" /><meta property="twitter:title" content="Containerized Security Toolkit - A Guide" /><meta name="twitter:site" content="@etheriosking" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-10-26T13:52:00-04:00","datePublished":"2024-10-26T13:52:00-04:00","description":"Since writing this blog, I’ve updated the project significantly with multiple image options. The bulk of the usage below remains relevant, but the images are now named cst-&lt;variant&gt;:arm (or amd for x86_64). Refer to the newer and much more detailed documentation for full details.","headline":"Containerized Security Toolkit - A Guide","image":{"alt":"CST Artwork","url":"https://tanishq.page/blog/assets/img/covers/cst-cover.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tanishq.page/blog/posts/cst-guide/"},"url":"https://tanishq.page/blog/posts/cst-guide/"}</script><title>Containerized Security Toolkit - A Guide | Tanishq Rupaal</title><link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/blog/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tanishq Rupaal"><meta name="application-name" content="Tanishq Rupaal"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/blog/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/blog/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/blog/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/blog/assets/js/dist/post.min.js"></script> <script defer src="/blog/app.min.js?baseurl=/blog&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B88HEPZBVJ"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-B88HEPZBVJ'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/blog/" id="avatar" class="rounded-circle"><img src="/blog/assets/Abstract.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/blog/">Tanishq Rupaal</a><p class="site-subtitle fst-italic mb-0">Cybersecurity Professional</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blog/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/blog/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/blog/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/blog/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tanq16" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/etheriosking" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['dragonking47','proton.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://linkedin.com/in/tanishqrupaal" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/blog/">Home</a> </span> <span>Containerized Security Toolkit - A Guide</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Containerized Security Toolkit - A Guide</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1729965120" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 26, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/blog/assets/img/covers/cst-cover.jpg" class="popup img-link preview-img shimmer"><img src="/blog/assets/img/covers/cst-cover.jpg" alt="CST Artwork" width="1200" height="630" loading="lazy"></a><figcaption class="text-center pt-2 pb-2">CST Artwork</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1653 words" > <em>9 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Containerized Security Toolkit - A Guide</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Containerized Security Toolkit - A Guide</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><blockquote class="prompt-tip"><p>Since writing this blog, I’ve updated the <a href="https://github.com/Tanq16/containerized-security-toolkit">project</a> significantly with multiple image options. The bulk of the usage below remains relevant, but the images are now named <code class="language-plaintext highlighter-rouge">cst-&lt;variant&gt;:arm</code> (or <code class="language-plaintext highlighter-rouge">amd</code> for x86_64). Refer to the newer and much more <a href="https://tanishq.page/containerized-security-toolkit/">detailed documentation</a> for full details.</p></blockquote><p>This blog is a guide on using the <a href="https://github.com/Tanq16/containerized-security-toolkit">Containerized Security Toolkit</a>, a project I maintain. The repository contains a quickstart command to instantly jump into a running instance. This guide, however, describes advanced workflows and usage of the toolkit.</p><h2 id="quickstart"><span class="me-2">Quickstart</span><a href="#quickstart" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this section, I describe a nuanced quickstart (includes a couple more settings than shown in the README) on using a containerized workflow. For a comprehensive and repeatable setup, check out the <em>Example Workflow</em> section further down in this blog post.</p><p>First, create a directory for persistence so that it can be mounted for container execution →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/docker_work/
</pre></table></code></div></div><p>Next, run the image (Docker will pull it automatically) with a <code class="language-plaintext highlighter-rouge">zsh</code> command to start the SSH server and read <code class="language-plaintext highlighter-rouge">/dev/null</code> to keep the image alive →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># Change tag to main_apple to use on ARM64 systems</span>
docker run <span class="nt">--name</span><span class="o">=</span><span class="s2">"security_docker"</span> <span class="se">\</span>
<span class="nt">-v</span> <span class="nv">$HOME</span>/docker_work/:/persist <span class="se">\</span>
<span class="nt">--rm</span> <span class="nt">-d</span> <span class="nt">-it</span> tanq16/sec_docker:main <span class="se">\</span>
zsh <span class="nt">-c</span> <span class="s2">"tail -f /dev/null"</span>
</pre></table></code></div></div><p>Then, use <code class="language-plaintext highlighter-rouge">docker exec</code> to get a shell into the container →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker <span class="nb">exec</span> <span class="nt">-it</span> security_docker /bin/zsh
</pre></table></code></div></div><p>Finally, run the following after getting into the container (<em>this is particularly useful if you follow my <a href="https://github.com/Tanq16/cli-productivity-suite/tree/master">CLI-Productivity-Suite</a></em>) →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm-256color <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /etc/localtime <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">ln</span> <span class="nt">-s</span> <span class="s2">"/usr/share/zoneinfo/</span><span class="si">$(</span>curl <span class="nt">-s</span> https://ipapi.co/timezone<span class="si">)</span><span class="s2">"</span> /etc/localtime <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">echo</span> <span class="si">$(</span>curl <span class="nt">-s</span> https://ipapi.co/timezone<span class="si">)</span> <span class="o">&gt;</span> /etc/timezone
</pre></table></code></div></div><p>Data that needs to be persisted across container runs should live in the <code class="language-plaintext highlighter-rouge">/persist/</code> directory, which is present on the host at <code class="language-plaintext highlighter-rouge">$HOME/docker_work/</code> (created earlier).</p><p>To stop the container after working on it, use the following →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker stop security_docker <span class="nt">-t</span> 0
</pre></table></code></div></div><blockquote class="prompt-warning"><p><strong><em>Note</em></strong> → One known issue that may come up is that the terminal colors may not behave in the best manner through the shell opened by Docker <code class="language-plaintext highlighter-rouge">exec</code>. This can be fixed by using SSH instead. The way to do this along with other customization is explained in the <em>Example Workflow</em> section next.</p></blockquote><h2 id="example-workflow"><span class="me-2">Example Workflow</span><a href="#example-workflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This is an example of setting up a more robust workflow for use in day to day life. I use this for my workflow and it works fantastically! The idea behind this workflow is as follows →</p><ol><li>Use a single command to launch a container<li>SSH into the container without hunting for what the password is<li>Use dynamic port forwarding with SSH to reach services exposed within the container<li>Persist a volume as well as the command history to make use of shell completion features of <code class="language-plaintext highlighter-rouge">oh-my-zsh</code><li>Use a single command to stop the container</ol><p>Implementing all of that is a one-time setup and fairly easy to follow (just looks super detailed). Use the following command to make the necessary directory structure for persistence →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/docker_work/
</pre></table></code></div></div><p>After that, add the following shell functions to the respective shell rc file →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c"># Start Container Function</span>
start_work<span class="o">(){</span>
    <span class="c"># run the container</span>
    docker run <span class="nt">--name</span><span class="o">=</span><span class="s2">"sec_docker"</span> <span class="nt">--rm</span> <span class="nt">-d</span> <span class="se">\</span>
    <span class="nt">-v</span> <span class="nv">$HOME</span>/docker_work/:/persist <span class="nt">-p</span> 50022:22 <span class="nv">$@</span> <span class="nt">-it</span> tanq16/sec_docker:main <span class="se">\</span>
    zsh <span class="nt">-c</span> <span class="s2">"service ssh start; cp /persist/.zsh_history /root/.zsh_history; tail -f /dev/null"</span>
    <span class="c"># create a new password for SSH-ing into the docker image</span>
    <span class="nv">new_pass</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> /dev/random | <span class="nb">head</span> <span class="nt">-c</span> 20 | <span class="nb">base64</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'=+/'</span><span class="si">)</span>
    <span class="c"># print the new password and store in a file in the current directory</span>
    <span class="nb">echo</span> <span class="s2">"Password: </span><span class="nv">$new_pass</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="nv">$new_pass</span> <span class="o">&gt;</span> current_docker_password
    <span class="c"># set the new password</span>
    docker <span class="nb">exec</span> <span class="nt">-e</span> <span class="nv">newpp</span><span class="o">=</span><span class="s2">"</span><span class="nv">$new_pass</span><span class="s2">"</span> sec_docker zsh <span class="nt">-c</span> <span class="s1">'echo "root:$(printenv newpp)" | chpasswd'</span>
<span class="o">}</span>

<span class="c"># Stop Container Function</span>
stop_work<span class="o">(){</span>
    <span class="c"># copy (save) the command history</span>
    docker <span class="nb">cp </span>sec_docker:/root/.zsh_history <span class="nv">$HOME</span>/docker_work/.zsh_history
    docker stop sec_docker <span class="nt">-t</span> 0
<span class="o">}</span>
</pre></table></code></div></div><blockquote class="prompt-tip"><p>Replace <code class="language-plaintext highlighter-rouge">main</code> tag with <code class="language-plaintext highlighter-rouge">main_apple</code> for ARM64 machines.</p></blockquote><p>With that done, the two functions above accomplish the following →</p><ul><li><code class="language-plaintext highlighter-rouge">start_work()</code> →<ul><li>It starts the container in a detached state and keeps it alive with <code class="language-plaintext highlighter-rouge">tail -f /dev/null</code><li>It exposes port <code class="language-plaintext highlighter-rouge">22</code> at host’s port <code class="language-plaintext highlighter-rouge">50022</code> for SSH<li>It accepts any additional Docker arguments (due to <code class="language-plaintext highlighter-rouge">$@</code>), like more port mappings or volume mounts<li>It copies over the previous <code class="language-plaintext highlighter-rouge">.zsh_history</code> to maintain history across container runs<li>It sets the root password to something random, prints it out, and puts it in a file</ul><li><code class="language-plaintext highlighter-rouge">stop_work()</code> →<ul><li>It copies over the shell history from the container to the persistence directory<li>It then stops the container</ul></ul><blockquote class="prompt-tip"><p><strong><em>Tip</em></strong> → On MacOS, add <code class="language-plaintext highlighter-rouge">echo $new_pass | pbcopy</code> to the <code class="language-plaintext highlighter-rouge">start_work()</code> function to automatically copy the password to the clipboard.</p></blockquote><p>Next, restart the shell or source the shell rc file, after which, the workflow can be used as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># prints the password to SSH into the container</span>
<span class="nv">$ </span>start_work
Password: pEBlVd1eBLkw01TlNpNtk4Xm6A

<span class="c"># ssh into the container with dynamic port forwarding</span>
<span class="nv">$ </span>ssh root@localhost <span class="nt">-p</span> 50022 <span class="nt">-D</span> 65500
</pre></table></code></div></div><p>Then, use this inside the container (<em>especially if you use my <a href="https://github.com/Tanq16/cli-productivity-suite/tree/master">CLI-Productivity-Suite</a></em>) →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm-256color <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /etc/localtime <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">ln</span> <span class="nt">-s</span> <span class="s2">"/usr/share/zoneinfo/</span><span class="si">$(</span>curl <span class="nt">-s</span> https://ipapi.co/timezone<span class="si">)</span><span class="s2">"</span> /etc/localtime <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">echo</span> <span class="si">$(</span>curl <span class="nt">-s</span> https://ipapi.co/timezone<span class="si">)</span> <span class="o">&gt;</span> /etc/timezone
</pre></table></code></div></div><p>Finally, after completing your work, exit the SSH session and stop the container with the <code class="language-plaintext highlighter-rouge">stop_work</code> command.</p><blockquote class="prompt-info"><p><strong><em>Note:</em></strong> Once you start <code class="language-plaintext highlighter-rouge">vim</code>, refer to the <a href="https://github.com/Tanq16/cli-productivity-suite/tree/master?tab=readme-ov-file#post-installation-steps">Post Installation Steps of my CLI Productivity Suite</a>, as the container uses that suite by default.</p></blockquote><p>While this workflow uses SSH (and there are reasons for it I talk about later), similar functions without the SSH requirements (instead only using <code class="language-plaintext highlighter-rouge">docker exec</code>) can be written as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>shell_work<span class="o">(){</span>
    docker <span class="nb">exec</span> <span class="nt">-it</span> sec_docker_direct zsh
<span class="o">}</span>
begin_work<span class="o">(){</span>
    docker run <span class="nt">--name</span><span class="o">=</span><span class="s2">"sec_docker_direct"</span> <span class="nt">--rm</span> <span class="nt">-v</span> <span class="nv">$HOME</span>/docker_work/:/persist <span class="nt">-d</span> <span class="nt">-it</span> tanq16/sec_docker:main
    docker <span class="nb">exec </span>sec_docker_direct zsh <span class="nt">-c</span> <span class="s1">'cp /persist/.zsh_history /root/.zsh_history'</span>
<span class="o">}</span>
end_work<span class="o">(){</span>
    <span class="c"># copy (save) the command history</span>
    docker <span class="nb">cp </span>sec_docker_direct:/root/.zsh_history <span class="nv">$HOME</span>/docker_work/.zsh_history
    docker stop sec_docker_direct <span class="nt">-t</span> 0
<span class="o">}</span>
</pre></table></code></div></div><p>For the exec-based workflow, the sequence should be <code class="language-plaintext highlighter-rouge">begin_work</code>, then <code class="language-plaintext highlighter-rouge">shell_work</code> to get a shell into the container, and finally <code class="language-plaintext highlighter-rouge">end_work</code> to stop the container.</p><h2 id="conventions"><span class="me-2">Conventions</span><a href="#conventions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this section, I talk about the conventions I use and recommend when using this image. The toolkit image is primarily meant to be used as a linux system for work. The idea is to have a single container with a persistent storage across multiple container runs. The <code class="language-plaintext highlighter-rouge">.zsh_history</code> file is also automatically copied in and out from the container by the start and stop functions.</p><p>The container was generally built with the intention of SSH-ing into it and making use of <code class="language-plaintext highlighter-rouge">tmux</code> to work in. While they can be exec-ed into as well, using SSH with <code class="language-plaintext highlighter-rouge">tmux</code> has the following advantages →</p><ul><li>The container can be deployed on various machines (like cloud VMs) and then SSH-ed into via non-standard ports<li>Using SSH allows dynamic port forwarding allowing easy access to any services exposed within the container<li>It fixes certain visual discrepancies that appear when exec-ing into the image (like the shell autocompletion color being overridden by solid white, making it weird to look at)</ul><p>The password is randomly generated and stored in the <code class="language-plaintext highlighter-rouge">current_docker_password</code> file in the current directory to use if you exit the SSH session and connect again.</p><p>The <code class="language-plaintext highlighter-rouge">start_work</code> function also includes a <code class="language-plaintext highlighter-rouge">$@</code>, mainly to add other port publish arguments or volume mounts arguments if necessary. One such example is for adding a Go-lang based directory structure, which can be done with the following argument passed to the <code class="language-plaintext highlighter-rouge">start_work</code> command →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>-v /path/to/host/go_programs/:/root/go/src
</pre></table></code></div></div><p>Other general conventions followed for building/running the images are →</p><ul><li>Port mapping follows convention - <code class="language-plaintext highlighter-rouge">shared port</code> = <code class="language-plaintext highlighter-rouge">port + 50000</code><li>Port for dynamic port forwarding when SSH-ing into the container = <code class="language-plaintext highlighter-rouge">65500</code><li>Volume mount to <code class="language-plaintext highlighter-rouge">/persist</code> (helps with persistence across runs or sessions)<li>General tools and installed under the <code class="language-plaintext highlighter-rouge">/opt</code> directory in the container, while executables are in <code class="language-plaintext highlighter-rouge">/opt/executables</code> (respective paths are already added in the container’s rc file)<li>Optionally maintain a <code class="language-plaintext highlighter-rouge">run.sh</code> in the persist directory file for custom initialization setup to run when the container starts</ul><h2 id="image-builds"><span class="me-2">Image Builds</span><a href="#image-builds" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The toolkit image is built via CI/CD pipelines and published to DockerHub. As such, the image is ready to pull like so →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker pull tanq16/sec_docker:main <span class="c"># or use main_apple for ARM64</span>
</pre></table></code></div></div><blockquote class="prompt-info"><p>The builds are pretty large in size due to some tools like <code class="language-plaintext highlighter-rouge">az-cli</code>. So the images are approximately 7-8 GB in size.</p></blockquote><p>The containers can be built by cloning my repository and using <code class="language-plaintext highlighter-rouge">docker build</code> command as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>git clone <span class="nt">--depth</span> 1 https://github.com/tanq16/containerized-security-toolkit
<span class="nb">cd </span>containerized-security-toolkit/security_docker_amd <span class="c"># security_docker_arm for ARM64</span>
<span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span>1 docker build <span class="nt">-f</span> builder.Dockerfile <span class="nt">-t</span> intermediate_builder <span class="nb">.</span>
<span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span>1 docker build <span class="nt">-t</span> sec_docker <span class="nb">.</span>
docker builder prune <span class="c"># cleanup storage</span>
</pre></table></code></div></div><h2 id="bonus"><span class="me-2">Bonus</span><a href="#bonus" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This section includes some quick productivity tips!</p><p>To use python based tools from the container, activate the python environment in the container with the following command →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">source</span> /opt/pyenv/bin/activate
</pre></table></code></div></div><p>To SSH into the container without adding details to the hosts file, use the following command →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh <span class="nt">-o</span> <span class="s2">"StrictHostKeyChecking=no"</span> <span class="nt">-o</span> <span class="s2">"UserKnownHostsFile=/dev/null"</span> root@localhost <span class="nt">-p</span> 50232
</pre></table></code></div></div><p>You can also add the following alias to your host’s rc file for ease of use →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">alias </span><span class="nv">sshide</span><span class="o">=</span><span class="s1">'ssh -o "StrictHostKeyChecking=no" -o "UserKnownHostsFile=/dev/null"'</span>
</pre></table></code></div></div><p>This alias is automatically setup if you use my <a href="https://github.com/tanq16/cli-productivity-suite">CLI Productivity Suite</a> on the host machine.</p><p>To remove dangling images when refreshing with new builds, use the following <code class="language-plaintext highlighter-rouge">docker rm</code> command (setup as an alias in my CLI Productivity Suite) →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">alias </span><span class="nv">dockernonerm</span><span class="o">=</span><span class="s1">'for i in $(docker images -f dangling=true -q); do docker image rm $i; done'</span>
</pre></table></code></div></div><h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I hope this blog post gives insight into how to use my containerized toolkit image for cybersecurity-related workflows. I use this container for my day-to-day work as a security professional and I found that it significantly improved my productivity across any environment or operating system I choose to work on. Cheers!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/categories/computers-and-security/">Computers and Security</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/blog/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/blog/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/blog/tags/container/" class="post-tag no-text-decoration" >container</a> <a href="/blog/tags/toolkit/" class="post-tag no-text-decoration" >toolkit</a> <a href="/blog/tags/workflow/" class="post-tag no-text-decoration" >workflow</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Containerized%20Security%20Toolkit%20-%20A%20Guide%20-%20Tanishq%20Rupaal&url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Fcst-guide%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Containerized%20Security%20Toolkit%20-%20A%20Guide%20-%20Tanishq%20Rupaal&u=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Fcst-guide%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Fcst-guide%2F&text=Containerized%20Security%20Toolkit%20-%20A%20Guide%20-%20Tanishq%20Rupaal" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Fcst-guide%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-npm/">Reverse Proxy in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/go-coding/">The Way to Go(lang)</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-budgetlord/">Expense Tracking in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-fusion/">Leantime in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/ai-rag/">Exploring RAG (Retrieval-Augmented Generation) and Talking to my Notes</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/container/">container</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/docker/">docker</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/github/">github</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/posts/docker-for-security/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1682833140" data-df="ll" > Apr 30, 2023 </time><h4 class="pt-0 my-2">Streamlining Security-Related Workflows with Docker Containers</h4><div class="text-muted"><p>I’m generally always looking for ways to improve my workflow and make my work as a cybersec professional more efficient. One of the tools that has had the biggest impact on my work is Docker. What...</p></div></div></a></article><article class="col"> <a href="/blog/posts/gha-docker-arch/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1717714320" data-df="ll" > Jun 6, 2024 </time><h4 class="pt-0 my-2">GitHub Actions & ARM Architecture</h4><div class="text-muted"><p>This blog post covers my troubleshooting efforts and research on how we can use GitHub workflows for various architectures. It focuses more on how to build container images for ARM in the absence o...</p></div></div></a></article><article class="col"> <a href="/blog/posts/cloudfoxable/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1687731720" data-df="ll" > Jun 25, 2023 </time><h4 class="pt-0 my-2">Cloudfoxable</h4><div class="text-muted"><p>Checkout the challenges over at GitHub. Setup &amp;amp; First Flag My initial setup starts with getting into my containerized security toolkit. From there, set up a sandbox account in the default org...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/posts/newbified-effective-notes/" class="btn btn-outline-primary" aria-label="Older" ><p>Effective Note-Taking</p></a> <a href="/blog/posts/ai-rag/" class="btn btn-outline-primary" aria-label="Newer" ><p>Exploring RAG (Retrieval-Augmented Generation) and Talking to my Notes</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/container/">container</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/docker/">docker</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/github/">github</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
